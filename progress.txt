Here is the updated `progress.txt`.

**Note on Progress Calculation:**
Because Design Document v2.0 introduces significant new mechanical systems (Squad AI, Variable Inertia, Class Systems, and the specific "Rescue-to-Deploy" loop), the overall completion percentage has **decreased** relative to the new scope. While the *codebase* hasn't changed, the *distance to the finish line* has increased.

***

# Skyline Survivors: Urban Defender - Implementation Progress (v2.0 Scope)

## 1. Core Concept

**Implementation Status: 65% Complete** ‚¨áÔ∏è (Adjusted for v2.0 Scope)

### Key Themes Progress:

‚úÖ **Fully Implemented:**
- Urban defense gameplay with district-based missions
- Ship/foot combat transitions via pilot ejection system
- Human rescue mechanics with landers and mutants
- Escalating difficulty through wave systems and boss encounters
- **Defend and Reclaim**: Districts exist in three states (Friendly/Threatened/Occupied)

‚ö†Ô∏è **Partially Implemented:**
- **Seamless transition (Ship/Foot):** Ejection exists, but the "Squad Leader" mechanics and "Rebuild at Hangar" loop are missing.
- **Resource vs. Score (The Rescue Loop):** Humans can be rescued for points, but they are not yet stored as "Cargo/Ammo" nor do they deploy troops upon drop-off.
- **Strategic Territory Control:** District states exist, but the "Loss Aversion" investment mechanics are missing.

‚ùå **Not Implemented:**
- **Operative Depth:** The 4 distinct classes (Infantry, Gunner, Medic, Saboteur) and Defensive Perimeter AI are missing.

---

## 2. High-Level Structure

### 2.1. System View Orbital Map

**Implementation Status: 83% Complete** (Unchanged by v2.0)

‚úÖ **Fully Implemented:**
- 3D rotating globe with selectable districts
- **City districts** displayed as nodes with three states (Friendly, Threatened, Occupied)
- **Battleships** roam between nodes
- **Special nodes:** Weapons Satellite, Mothership (Endgame)
- Consequence system: Threatened ‚Üí Occupied
- **Victory Condition:** Complete Mothership assault

‚ùå **Not Implemented:**
- **District Investment Levels (Dark Pattern):** Friendly districts accumulating "Prosperity Multiplier" (Loss Aversion mechanic).
- **The "Near-Miss" Timer:** 30-second flashing "CRITICAL" state.

### 2.2. Side-Scrolling Combat View

**Implementation Status: 60% Complete** ‚¨áÔ∏è (New Hangar/Drop-off requirement)

#### Defense Missions (Threatened Districts)
**Implementation Status: 75% Complete**
‚úÖ **Fully Implemented:**
- Defend districts (15 waves) / Wave tier progression
- Mini-boss and boss encounters / Battleship encounter

‚ùå **Not Implemented:**
- **Extraction Hubs (Fortified Hangars):** Visual entity for dropping off humans is missing.
- **Deployment Animation:** Spawning squad members upon human drop-off.

#### Assault Missions (Occupied Districts)
**Implementation Status: 75% Complete**
‚úÖ **Fully Implemented:**
- Base core objective with HP / Shield generators / Turrets
- Garrison defender squads

‚ùå **Not Implemented:**
- **Saboteur Synergy:** Specific interactions where Saboteurs disable turrets.
- **Guardian Form Synergy:** Increased effectiveness against structures.

---

## 3. Gameplay Overview & The Rescue Loop

### 3.1 The Rescue & Drop-Off Loop (New v2.0 Section)

**Implementation Status: 20% Complete**

‚úÖ **Fully Implemented:**
- Basic Human Rescue (picking up a human).

‚ùå **Not Implemented:**
- **"Strike Force" Carry:** Storing multiple humans in cargo (UI indicator missing).
- **Inertia Scaling:** Ship physics do not yet change based on human cargo count.
- **Tactical Deployment:** Dropping humans at a specific Hangar point to spawn AI Comrades.

### 3.2 Core Loop

**Implementation Status: 80% Complete**
‚úÖ **Fully Implemented:**
- System Map -> Combat -> Upgrade cycle.
- Ship Destruction -> Ejection.

‚ö†Ô∏è **Partially Implemented:**
- **Crisis Management:** Hangar rebuild loop works (hold under hangar for 30s) but still lacks squad-following aura and sacrifice behaviors.

---

## 4. Player Mechanics & Operative Systems

### 4.1. Ship Forms & Movement

**Implementation Status: 90% Complete**

‚úÖ **Fully Implemented:**
- **Normal Fighter Form:** 8-directional movement, Primary Weapon, Smart Bomb, Hyperspace.
- **Guardian Form:** Toggle, Slowed movement, 360¬∞ aim.

‚ùå **Not Implemented:**
- **Variable Inertia Mechanic:** Physics modifier based on `CargoCount`.
- **Guardian Defensive Perimeter:** Signaling ground AI to form a ring around the ship.

### 4.2. Operative AI & Combat Behavior ("The Comrades")

**Implementation Status: 10% Complete** (Major Gap for v2.0)

‚úÖ **Fully Implemented:**
- Basic concept of an "Ally" entity exists (garrison defenders).

‚ùå **Not Implemented:**
- **Squad Formation:** AI following the player or forming fire teams.
- **Operative Classes:**
  - *Standard Infantry:* (Common)
  - *Heavy Gunner:* (Uncommon - Braced fire)
  - *Combat Medic:* (Rare - Health drops)
  - *Saboteur:* (Elite - Anti-base logic)
- **Weapon Synergy:** Tier 3 ship overflow upgrading ground troops.

### 4.3. On-Foot Command (Ship Destruction)

**Implementation Status: 45% Complete**

‚úÖ **Fully Implemented:**
- Ejection Sequence (Pilot sprite, basic pistol).
- **Extraction Defense:** Hold the line under the Hangar for 30 seconds to rebuild the Veritech (with HUD instructions + ground marker).

‚ùå **Not Implemented:**
- **Squad Leader Aura:** Comrades following pilot movement (Bullet Hell wall).
- **Sacrifice Mechanic:** AI behavior to body-block shots during rebuild.

### 4.4. Power-Up System

**Implementation Status: 65% Complete**

‚úÖ **Fully Implemented:**
- Core Weapons (Laser, Spread, Missiles) - 3 Tiers.
- Defensive (Shields, Speed).
- Utility (Smart Bombs, Multipliers).
- Weapon Decay & Switching.

‚ùå **Not Implemented:**
- **Tier 3 Overflow:** Logic to detect Max Tier and redirect power-up to Ground Troop stats.
- **Assault Rewards:** Base destruction dropping specific loot.

---

## 5. Enemy Design

**Implementation Status: 100% Complete**
‚úÖ **Fully Implemented:**
- Landers, Mutants, Bombers, Pods, Baiters, Swarmers.
- Advanced variants (Kamikaze, Turret, Shield, Seeker, etc.).
- Bosses (Mega Lander, Titan Mutant, etc.).

---

## 6. Game Systems

### 6.1. Radar / HUD

**Implementation Status: 80% Complete**
‚úÖ **Fully Implemented:**
- Radar (Player, Enemies, Objectives).
- Mission Objectives (Wave Count / Base HP).

‚ùå **Not Implemented:**
- **Cargo/Squad UI:** Indicator for currently carried humans and currently deployed squad count.
- **Dark Patterns:** Engagement "Combo Meter" and pulsing "Near-Miss" urgency.

### 6.2. Meta Progression (Shop)

**Implementation Status: 75% Complete**
‚úÖ **Fully Implemented:**
- Supply Drop Gacha (Credits, Unboxing, Loot History).

‚ùå **Not Implemented:**
- **Inventory Hot-Starts:** Applying the "Supply Drop" items to the very next run.

---

## 7. Environment Design

**Implementation Status: 55% Complete**
‚úÖ **Fully Implemented:**
- Multi-layer parallax (Sky, City, Street).

‚ùå **Not Implemented:**
- **Extraction Hub (Hangar):** Specific visual asset for the drop-off point in Defense missions.
- Dynamic Weather/Time of Day.

---

## Gap Analysis & Next Steps (Updated for v2.0)

**Overall Implementation:**
- ‚úÖ **Implemented:** ~65% (Dropped from 88% due to new Squad/Physics scope)
- ‚ö†Ô∏è **Partially Implemented:** ~20%
- ‚ùå **Not Implemented:** ~15%

### üö® Critical v2.0 Mechanics (The "New Fun")
The core Rescue Loop components (cargo carry, hangar drop-off, operative deployment) are now present. The remaining gaps are mostly in *feel*, *feedback*, and *synergy*.

1.  **Inertia Scaling:** Ship physics update: `drag = baseDrag + (cargo * weightModifier)`.
2.  **Cargo/Squad UI:** HUD indicator for carried civilians and active operatives.
3.  **Guardian Defensive Perimeter:** Operatives forming a ring and prioritizing protection while in Guardian form.
4.  **Squad Leader Aura:** On-foot comrades follow the pilot and focus fire in formation.
5.  ‚úÖ **Hangar-Based Rebuild Loop:** Ship rebuild now tied to the hangar/defense point instead of the dropship encounter.

### Revised Immediate Next Steps:

**Priority 1: Cargo Weight + HUD Feedback (2-3 Days)**
- Add inertia scaling to `playerControls` so cargo count influences accel/drag.
- Add HUD counters for cargo + deployed operatives.
- Add audio/visual feedback when cargo is dropped off.

**Priority 2: Guardian/On-Foot Squad Behaviors (3-4 Days)**
- Implement Guardian defensive ring positioning and fire priorities.
- Add Squad Leader aura: operatives follow pilot and align their firing angles.
- Ensure transition logic between patrol/guardian/on-foot states.

**Priority 3: Hangar Rebuild Flow (2-3 Days)**
- ‚úÖ Replace dropship extraction rebuild with a hangar timer/hold-the-line mechanic.
- ‚ùå Add sacrifice behavior for operatives to body-block shots during rebuild.

**Priority 4: Mothership & Campaign Polish (Existing Goal - 4 Days)**
- Continue with the Multi-phase Mothership boss as planned (this is still the endgame).

---

## Estimated Remaining Work (v2.0 Scope)

- **Rescue/Deploy Loop:** 4 days
- **Operative AI & Classes:** 5 days
- **Mothership Boss:** 4 days
- **UI/Feedback Polish:** 2 days
- **Total to v2.0 MVP:** ~15 Days
