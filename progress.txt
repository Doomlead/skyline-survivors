# Skyline Survivors: Urban Defender - Implementation Progress

## 1. Core Concept

**Implementation Status: 76% Complete** ‚¨ÜÔ∏è (was 75%)

### Key Themes Progress:

‚úÖ **Fully Implemented:**
- Urban defense gameplay with district-based missions
- Ship/foot combat transitions via pilot ejection system
- Human rescue mechanics with landers and mutants
- Escalating difficulty through wave systems and boss encounters
- **Defend and Reclaim**: Districts exist in three states - friendly, threatened, or enemy-occupied

‚ö†Ô∏è **Partially Implemented:**
- Seamless transition between ship and foot combat (basic version exists, needs depth)
- Rescue armed ground operatives (rescue exists, operative squad system missing)
- Dynamic front lines with strategic territory control (district state changes and battleship pressure exist, strategic layer missing)

‚ö†Ô∏è **Partially Implemented:**
- Strategic territory control layer (urgency + reward/spawn multipliers exist, but no explicit priority UI or district value impacts)

---

## 2. High-Level Structure

### 2.1. System View Orbital Map

**Implementation Status: 83% Complete** ‚¨ÜÔ∏è (was 80%)

‚úÖ **Fully Implemented:**
- 3D rotating globe with selectable districts
- **City districts** displayed as nodes with three states:
  - üü¢ **Friendly** (Secured) - No immediate action needed
  - üü° **Threatened** (Under Attack) - Requires defense
  - üî¥ **Occupied** (Enemy Controlled) - Requires assault
- **Battleships** roam between nodes, attacking friendly districts
- **Special nodes:**
  - Weapons Satellite (Shop)
  - **Mothership** (Final Endgame Target - locked until all districts secured)
  - Relay stations, distress beacons
- District selection and launch flow
- Occupied districts force assault launch mode with updated UI labeling
- Threat indicators with pulsing urgency rings and under-attack highlights
- District timers and state persistence
- District directives include urgency + reward/spawn multipliers surfaced in the mission panel
- Roaming battleship markers with travel/assault phases
- Battleship assaults drain district timers and flag districts as under attack
- Orbit node timers and status readouts in the build mission panel
- Districts under battleship attack become threatened
- Timer countdown shows when district will fall if not defended
- Consequence system: threatened districts can fall to occupied if ignored
- District state transitions (win ‚Üí friendly, loss ‚Üí occupied)
- **Mechanics:**
  - **Defensive Missions:** Select threatened districts to defend from 15 waves
  - **Assault Missions:** Attack occupied districts to destroy enemy ground bases
- **Victory Condition:** Complete Mothership assault ‚Üí Campaign victory screen

‚ùå **Not Implemented:**
- **Special nodes:**
  - Challenge Missions (nodes are visual only, not functional)

---

### 2.2. Side-Scrolling Combat View

**Implementation Status: 70% Complete** ‚¨ÜÔ∏è (was 65%)

**Perspective:** ‚úÖ Horizontal wraparound map above a cityscape

#### Defense Missions (Threatened Districts)
**Implementation Status: 90% Complete** ‚¨ÜÔ∏è (was 85%)

‚úÖ **Fully Implemented:**
- Defend districts through **exactly 15 waves**
- Wave-based enemy spawning system
- Wave tier progression (waves 1-5 light, 6-10 heavy, 11-14 elite)
- Human rescue mechanics
- Power-up collection
- Mini-boss and boss encounters
- Wave 15: **Battleship** mini-boss encounter
- **Mission Objective Indicator (Defense):** Wave count (X/15) displayed in HUD
- Extract after wave 15 to **secure district** (mission success updates district state)

‚ùå **Not Implemented:**
- Rescue armed ground operatives as **squad members** (basic rescue exists, squad system missing)
- High comrade density emphasis
- Bonus rewards for zero civilian casualties

#### Assault Missions (Occupied Districts)
**Implementation Status: 75% Complete** ‚¨ÜÔ∏è (was 60%)

‚úÖ **Implemented:**
- Assault mission mode override for occupied districts
- Base core objective with HP and victory condition
- Shield generators that must be destroyed to expose the core
- Defensive base turrets with auto-fire
- Garrison defender squads spawned around the base (rifle/shield/medic/etc.)
- Assault HUD objective display with base core bar + shield count
- Continuous defender reinforcements during assault missions
- Successful assault clears district back to friendly state
- Base destruction score reward on core defeat
- Mission type affects enemy composition (assault-specific reinforcement spawns)

‚ùå **Not Implemented:**
- **Ground base components:**
  - Multi-phase core reactor beyond current base core
- Failure flow for assaults beyond game-over (retreat/retry loop, mid-mission extraction)
- High-value power-ups inside base
- Risky infiltration opportunities
- Destroy all enemy forces requirement
‚ö†Ô∏è **Partially Implemented:**
- Minimal comrade presence is represented by reduced human spawns in occupied districts (lower human count in directives), but no explicit mutant-heavy replacement or dramatic scarcity.

**Key Features:**
‚úÖ **Implemented:**
- Radar HUD (Defender-style)
- Parallax cityscape (basic version)

‚ùå **Not Implemented:**
- Dynamic weather/day-night cycle

---

### 2.3. Meta Progression

**Implementation Status: 70% Complete** ‚¨ÜÔ∏è (was 60%)

‚úÖ **Fully Implemented:**
- District clearing tracking
- Meta progression framework with credits, unlocks, and loadouts
- Between-mission shop inventory + loadout selection UI
- Persistent storage and run history
- Failed defense consequences (district destruction states)
- **Battleship Threat System:** Roaming battleships target friendly districts over time
- **Mothership Unlock:** Orbit node becomes available when all districts are friendly (none occupied)
- District state transitions fully functional
- Campaign victory flow with dedicated victory overlay + stats + return options

‚ùå **Not Implemented:**
- **Planetary Control Tracker:** Visual representation of friendly vs. occupied territories percentage
- **Dynamic Difficulty:** More occupied districts = stronger battleship presence

2.3.1: Shop System (Replaced "Shop & Loadouts")
2.3.1. The "Supply Drop" Gacha Shop

Access Point: The Weapons Satellite / Orbit node.
Core Philosophy: Replaces the static purchase of permanent loadouts with a Variable Ratio Reinforcement model (Loot Boxes). Players spend persistent currency to gamble on "Supply Drops" that provide powerful advantages only for the immediate next deployment.

Currency:

    Meta Credits: Earned during gameplay. Used to purchase Supply Drops.
    Bank Logic: Players must decide whether to hoard credits for a difficult Assault Mission or spend them now to survive a Threatened District.

Inventory Model (Consumable "Hot Starts"):
Items obtained from the shop are single-use and apply automatically to the very next mission the player launches. They do not persist if the ship is destroyed or the mission is completed.

The Loot Boxes (Supply Pods):
Players purchase "Encryption Keys" to unlock orbital drops.

    Standard Drop (Cost: Low): High chance of Utility items, low chance of Weapon/Defense buffs.
    Elite Drop (Cost: High): High chance of Weapon Tiers, guarantees at least one tier 2 power up.

Loot Table (Run-Specific Power-ups):
Instead of selecting a loadout, the box grants 1-3 random items from the following pool:

    "Hot Start" Weaponry: Start the mission with Laser Tier 1, Spread Tier 1, or Homing Tier 1 (bypassing the early game build-up).
    Ordnance Stockpile: Start with +2 Smart Bombs (above default).
    Ablative Overlay: Start with a temporary shield layer.
    Escort Lease: Start with a Drone companion (lasts until destroyed).
    Mercenary Contract: A computer-controlled Ground Operative spawns at the start of the match (Assault Mission specific).

New Section: 2.3.2. The Shop "Dopamine" Sequence

Visual & Audio Design (The Hook):
The purchase process is not instant; it is a dedicated "Unboxing Event" designed to spike player anticipation and gratification.

    The Trigger: When the player buys a Supply Drop, the UI fades. A cinematic view shows an orbital satellite rotating into position.
    The Build-Up (Anticipation):
        Audio: A rising mechanical turbine whine (Shepard Tone) that increases in pitch and volume.
        Visual: The satellite charges energy. The color of the energy (Blue, Purple, or Gold) teases the rarity of the item inside before it drops.
    The Drop: The pod fires downward. The camera slams down to the hangar deck.
    The Impact (The Rush):
        The pod slams into the hangar floor with a screen shake and a heavy bass THUD.
        Steam vents hiss loudly (white noise release).
    The Reveal (Jackpot):
        The pod panels explode outward.
        Visual: High-intensity "God Rays" emit from the center. If the item is high-tier, the screen flashes white, then fades in with gold confetti particles and a slow-motion rotation of the Power-Up icon.
        Audio: A high-frequency "Casino Win" chime or major chord strikes in sync with the visual flash.
    Equip Feedback: The item flies from the pod into the player‚Äôs ship schematic, locking in with a satisfying metallic CLANK, confirming they are powered up for the next run.


---

### 2.4. Title Briefing & Main Menu

**Implementation Status: 90% Complete** ‚¨ÜÔ∏è (was 0%)

‚úÖ **Implemented:**
- Title briefing overlay with typed terminal-style mission recap
- Skip/authorize flow that transitions into the main menu
- Keyboard support (Space/Enter) for skipping and authorizing
- Briefing text adapts to current district summary

‚ùå **Not Implemented:**
- Multiple briefing variants or branching narrative intros

---

## 3. Gameplay Overview

### 3.1 Core Loop

**Implementation Status: 76% Complete** ‚¨ÜÔ∏è (was 70%)

‚úÖ **Implemented:**
1. **System Map:** District selection, status viewing, battleship tracking
2. **Mission Selection:** Defense or assault missions selected based on district state
3. **Combat Mission:** Ship combat, human rescue, 15-wave completion or assault base objective
4. **Extract/Upgrade:** Return to system map, shop access, district status checks
5. **Campaign Progression:** Mothership node unlocks when all districts friendly
6. **Campaign Victory:** Mothership mission completion triggers campaign victory screen

‚úÖ **Core Loop Complete:**
- Threatened districts ‚Üí Defense mission ‚Üí Win/lose ‚Üí District friendly/occupied
- Occupied districts ‚Üí Assault mission ‚Üí Destroy base ‚Üí District friendly
- All districts friendly ‚Üí Mothership unlocks

‚ùå **Not Implemented:**
1. **System Map:** Full assessment tools
   - Strategic priority recommendations UI (beyond current urgency/reward/spawn multipliers)

2. **Combat Mission:**
   - Fight on foot **with rescued operatives** (operative squad system missing)
   - **Assault missions** still lack multi-phase core behavior

---

## 4. Player Mechanics

### 4.1. Ship Forms & Movement

#### 4.1.1. Normal Fighter Form
**Implementation Status: 100% Complete** ‚úÖ

‚úÖ **Fully Implemented:**
- Movement: 8-directional, slight inertia
- Primary Weapon: Forward blaster (direction matches facing)
- Secondary Actions:
  - Smart Bomb: Screen-clearing attack (limited charges)
  - Hyperspace: Emergency teleport (risky spawn)

#### 4.1.2. Guardian Form
**Implementation Status: 100% Complete** ‚úÖ

‚úÖ **Fully Implemented:**
- Activation: Toggle button
- Movement: Drastically slowed
- Aim/Fire: 360¬∞ aim (mouse/right stick)
- Firepower: Higher DPS, special shot types
- **Works as designed for Assault Missions:** Effective for base destruction

---

### 4.2. Ground Combat & Operative System

**Implementation Status: 40% Complete**

#### 4.2.1. Ship Destruction ‚Üí Foot Combat
**Implementation Status: 40% Complete**

‚úÖ **Implemented:**
- Ship destroyed ‚Üí Pilot ejects and lands near crash site
- Basic on-foot movement with gravity and jumping
- Pilot uses the same weapon/projectile system while on foot
- Re-entry to rebuilt ship after extraction

‚ùå **Not Implemented:**
- **Ejection Sequence:**
  - Rescue nearby comrades to form a squad
- **On-Foot Mechanics:**
  - Distinct ground weapons: Pistol, rifle, grenades, improvised weapons
  - Cover System: Use debris, buildings, destroyed vehicles
  - **Assault Mission Advantage:** Ground combat effective against base defenses
- **Operative AI:**
  - Basic Combat: Auto-fire at enemies
  - Special Roles:
    - Turret Operative: Man mounted guns
    - Medic: Heal player
    - Engineer: Repair vehicles / Sabotage enemy base systems

#### 4.2.2. Rebuilding/Extraction
**Implementation Status: 60% Complete**

‚úÖ **Implemented:**
- Rescue dropship extraction encounter
- Trigger mini-boss fight to secure extraction
- Return to system map with ship rebuilt

‚ùå **Not Implemented:**
- **Rebuild Station (Optional):**
  - Collect alien tech to rebuild stronger ship (risk/reward)

#### 4.2.3. Comrade Rescue & Mutation Risk
**Implementation Status: 50% Complete**

‚úÖ **Implemented:**
- Touch comrades to pick them up (basic rescue)
- Landers abduct humans and mutate them into mutants
- Score rewards for rescues
- Mutant enemies spawn and behave as threats

‚ùå **Not Implemented:**
- **Rescue Mechanics:**
  - While carried, comrades fire at enemies (gun pod effect)
  - Deposit at safe zones for score/currency
  - Temporary buffs from deposited comrades (e.g., shield recharge)
- **Mutation Risk:**
  - Kill mutants for bonus points OR risk rescuing them back
  - **In Occupied Districts:** Fewer comrades available (most captured/converted)

---

### 4.3. Power-Up & Weapon System

**Implementation Status: 70% Complete** ‚¨ÜÔ∏è (was 60%)

#### 4.3.1. Power Sources
**Implementation Status: 90% Complete**

‚úÖ **Implemented:**
- Airborne Power Capsules: Dropped by enemies
- Surface Items: Scattered on ground (fly low to collect)
- Base core destruction grants a score bonus

‚ùå **Not Implemented:**
- **Base Destruction Rewards:** Major power-up drops from destroyed enemy bases

#### 4.3.2. Upgrade Paths
**Implementation Status: 60% Complete**

‚úÖ **Implemented:**
Ship Power-Ups & Effects
Offensive / Weapon Power-Ups

    Laser Upgrade: Increases laser tier up to tier 2, which changes the projectile type fired (see playerState.powerUps.laser tier usage in firing logic).

    Force Drone: Adds a combat drone escort (up to 3 drones total) by spawning a forceDrone sprite when collected.

    Homing Missiles: Enables missile firing behavior

    Rear Shot: Enables rear-firing shot pattern

    Side Shot: Enables lateral shot pattern

    Multi‚ÄëShot: Enables multi-projectile firing pattern

    Piercing Shots: Enables piercing projectiles

    Double Damage: Temporarily doubles weapon damage

Rate / Speed Power-Ups

    Overdrive: Temporarily sets a very fast firing cadence

    Rapid Fire: Temporarily speeds up firing

    Speed Boost: Temporarily boosts player movement speed 

Defensive / Utility Power-Ups

    Shield: Grants a shield hit that absorbs damage 

    Invincibility: Temporary invulnerability 

    Time Slow: Temporarily slows enemies/projectiles (p.timeSlow = 8000 ms), applied as a global speed multiplier.

    Power Magnet: Temporarily pulls nearby power-ups toward the player 

Inventory Power-Ups

    Smart Bomb: Adds one bomb to the player stock

‚ùå **Not Implemented:**

| System | Current Implementation | Design Goal | Gap |
|--------|----------------------|-------------|-----|
| Laser | Single ‚Üí Spread ‚Üí Wave | Single ‚Üí **Twin** ‚Üí Spread ‚Üí Wave Beam | Missing Twin tier |
| Force Drone | Basic only | Front ‚Üí Orbit ‚Üí Detached | Missing progression system |
| Shield | Basic only | Ablative segments ‚Üí Timed invulnerability | Missing tier progression |
| Homing Missiles | Basic only | Basic ‚Üí Swarms ‚Üí Guided Barrage | Missing tier progression |
| Overdrive | Basic only | +Duration ‚Üí +Damage ‚Üí Screen-Filling Chaos | Missing tier progression |

#### 4.3.3. Combo Examples
**Implementation Status: 0% Complete**

‚ùå **Not Implemented:**
- Force Drone + Spread Laser: Rotating projectile ring synergy
- **Afterburner + Shield: "Ram Mode"** - crash into base defenses safely
- **Homing Missiles + Overdrive: Apocalypse swarm** - base siege weapon

### Recommended Implementation Path:

**Option A: Keep Current System (Simpler)**
- Laser: Tiered (Piercing ‚Üí Wave progression)
- Drone: Tiered (Front ‚Üí Orbit ‚Üí Detached)
- All others: Single-level toggles/buffs
- **Pros**: Already implemented, simpler balance
- **Cons**: Less progression depth

**Option B: Add New Tiers (Design Document Vision)**
- Create new tiered pickup types for:
  - Shot Pattern (Single ‚Üí Twin ‚Üí Spread ‚Üí Multi)
  - Coverage (Forward ‚Üí +Rear ‚Üí +Side)
  - Homing (Basic ‚Üí Swarms ‚Üí Barrage)
- **Pros**: Deeper progression, clearer upgrade paths
- **Cons**: Requires new pickup entities and tier tracking

**Hybrid Recommendation:**
- Keep current single-level system for most pickups
- Add Homing Missile tier progression (3 levels: Basic ‚Üí Swarms ‚Üí Barrage)
- Document that Shot Pattern/Coverage are achieved through collecting multiple single-level pickups
- This provides progression depth without major refactoring

#### 4.3.8. Power-Up Decay & Primary Weapon Switching
**Implementation Status: 85% Complete** ‚¨ÜÔ∏è (was 0%)

‚úÖ **Implemented:**
- Tier decay timers for Laser, Multi-Shot, Coverage, and Homing tiers (downgrade when timers expire)
- Primary weapon tracking (Laser vs Multi-Shot) with manual toggle and auto-normalization
- Decay refresh on pickup and tier-based duration scaling

‚ùå **Not Implemented:**
- Explicit ‚ÄúMystery Tech‚Äù jackpot drop cadence tied to base destruction

#### 4.3.9. HUD Decay Visualization (Low-Clutter Plan)
**Implementation Status: 75% Complete** ‚¨ÜÔ∏è (was 0%)

‚úÖ **Implemented:**
- Primary decay bar with tier label for the active weapon (Laser or Multi-Shot)
- Compact decay bars for Coverage, Homing, and Overdrive
- Timed buff status strip for active temporary power-ups
- Flash-reduction accessibility toggle honored by decay HUD pulses

‚ùå **Not Implemented:**
- Dedicated downgrade warning flashes beyond the current pulse/alpha swap


## 5. Mission Types

### 5.1. Defense Missions (Threatened Districts)

**Implementation Status: 90% Complete** ‚¨ÜÔ∏è (was 85%)

‚úÖ **Implemented:**
- **Objective:** Survive 15 waves of enemies
- Wave-based combat system with increasing difficulty
- Wave tier progression for light/heavy/elite enemy mixes
- Boss encounters at wave completion
- Wave 15: **Battleship** mini-boss
- Human rescue mechanics during waves
- Power-up drops throughout waves
- Wave counter HUD display (X/15)
- **Success state:** District remains friendly (state change from threatened ‚Üí friendly on mission completion)
- **Failure state:** District becomes occupied

‚ùå **Not Implemented:**
- **Special Features:**
  - Emphasized high comrade density to rescue
  - Power-up drops that increase per wave tier
  - Bonus rewards for zero civilian casualties

---

### 5.2. Assault Missions (Occupied Districts)

**Implementation Status: 75% Complete** ‚¨ÜÔ∏è (was 60%)

‚úÖ **Implemented:**
- **Objective:** Destroy the enemy ground base
- Assault mission mode override for occupied districts
- Base core target with HP and mission-complete condition
- **Ground Base Components:**
  - Shield generators that gate core damage (must destroy first)
  - Defensive base turrets with auto-fire
  - Core Reactor as primary target
- Garrison defender squads guarding the base
- Assault reinforcement spawns during mission
- Assault mission completion restores district to friendly
- Base core destruction bonus reward
- **Success:** District returns to friendly control
- Assault HUD display showing base core HP + shield status

‚ùå **Not Implemented:**

**Structure:**
- **Ground Base Components:**
  - Multi-phase core reactor beyond current base core

**Tactics:**
- Ground assault: Deploy on foot to sabotage systems
- Engineers can disable shields faster
- Base destruction triggers explosion and evacuation sequence

**Failure:** Forced retreat, district remains occupied (currently only game-over)

**Special Features:**
- High-value power-up drops inside base
- Risky but rewarding infiltration opportunities
‚ö†Ô∏è **Partially Implemented:**
- Minimal comrade presence is represented by reduced human spawns in occupied districts (lower human count in directives), but no explicit mutant-heavy replacement or dramatic scarcity.

---

## 6. Environment Design

### 6.1. Parallax Cityscape
**Implementation Status: 60% Complete** ‚¨ÜÔ∏è (was 55%)

‚úÖ **Implemented:**
- Procedurally generated multi-layer parallax backgrounds (sky, atmosphere, stars, horizon city, mid city, terrain)
- Multiple procedural background styles (cyberpunk, industrial, wasteland)
- Consistent ground/terrain layer used for gameplay bounds
- Mothership exterior/interior procedural layer sets wired into the background manager

‚ùå **Not Implemented:**
- **Foreground:** Destroyable buildings, hidden pickups
- **Mid-Ground:** Traffic, civilians, flying cars
- **Background:** Megastructures, dynamic weather
- **Sky Layer:** Day/night cycle affecting visibility

### 6.2. District Themes

**Implementation Status: 10% Complete** ‚¨ÜÔ∏è (was 0%)

‚ö†Ô∏è **Partially Implemented:**
- Multiple background style generators exist, but are not mapped to districts or gameplay modifiers

‚ùå **Not Implemented - Complete System:**

| District | Defense Features | Assault Features |
|----------|------------------|------------------|
| Downtown Core | Narrow corridors; ideal for Guardian Mode | Fortified skyscrapers; vertical base structures |
| Industrial Zone | Crushing machinery, toxic spills | Factory bases with assembly line defenses |
| Residential Sector | High comrade density; hostage situations | Underground bunker bases |
| Dockyards | Water enemies, cranes | Naval base with water defenses |
| Orbital Platform | Low gravity, rotating platforms | Space station base with shield layers |

---

## 7. System Map & Meta Layer

### 7.1. System Map Mechanics

**Implementation Status: 70% Complete** ‚¨ÜÔ∏è (was 60%)

‚úÖ **Fully Implemented:**
- **District States:** Three-state system fully functional
  - üü¢ **Friendly:** Secured, no immediate action needed
  - üü° **Threatened:** Under battleship attack, defense mission available
  - üî¥ **Occupied:** Enemy controlled, assault mission required
- **Dynamic Threats:**
  - **Battleships** roam the map, targeting friendly districts
  - Districts under battleship attack become threatened
  - Timer countdown shows when district will fall if not defended
  - Ignoring threats ‚Üí District falls to occupied
  - Failed defense ‚Üí District becomes occupied ‚Üí Assault mission unlocked
- District threat states with visual indicators
- District occupation tracking
- Weapons Satellite shop node
- Orbit nodes with timers (shop/relay/distress/battleship/mothership)
- Meta currency system
- Permanent upgrade purchases
- District mission panel shows urgency, reward multiplier, and spawn multiplier
- Roaming battleships drain district timers during assaults
- Urgency-based mission modifiers
- District threat timers expiring into occupied state
- Successful defense resets district to friendly
- Successful assault returns district to friendly state
- Complete district state transition flow

‚ùå **Not Implemented:**
- **Strategic Layer:**
  - Prioritization UI for defenses vs. reclamation
  - District value indicators (resources, strategic position)
  - Key district loss consequences (increased battleship aggression)
- Global difficulty spike based on number of occupied districts

### 7.2. Mothership Assault (Final Mission)

**Implementation Status: 30% Complete** ‚¨ÜÔ∏è (was 10%)

‚úÖ **Implemented:**
- **Unlock Condition:** Mothership orbit node activates when all districts are friendly (none occupied)
- Mothership node visible and selectable on system map
- Mothership mission launch from orbit node with dedicated mission directives
- Initial mothership core boss visuals + behavior
- Mothership core fight with HP-based phase shifts and reinforcement spawns
- Mothership assault HUD bar support (core HP + phase label)

‚ùå **Not Implemented - Complete Mission:**
- **Structure:**
  - **Phase 1:** Exterior defense ring (battleship gauntlet)
  - **Phase 2:** Interior corridors with traps and elite forces
  - **Phase 3:** Core boss fight (Mothership Queen/AI)
- **Detailed Plan (Framing the Mothership Phases):**
  - **Phase 1: Exterior Assault (Ship Combat)**
    - **Objective:** Breach the mothership exterior defenses to unlock entry.
    - **Flow:** Begin in ship mode only, fight a gauntlet of defensive fleets and hull emplacements.
    - **Signature beats:** Rotating shield nodes, exterior turret ring, optional mini-boss encounter to drop entry code.
    - **Success criteria:** Destroy all exterior shield nodes ‚Üí mothership docking bay opens.
    - **Failure criteria:** Player death or time-out ‚Üí retreat to system map.
  - **Transition 1 ‚Üí 2: Docking/Boarding**
    - **Event:** Cinematic/teleport dock sequence to swap to interior state.
    - **State change:** Lock ship combat temporarily; emphasize on-foot play.
  - **Phase 2: Interior Procedural Corridors (On-Foot Focus)**
    - **Objective:** Navigate procedurally generated corridors to reach the core chamber.
    - **Flow:** On-foot traversal with trap rooms, elite patrols, and limited safe nodes.
    - **Signature beats:** Security gates, power conduit puzzles, ambush rooms, optional side rooms for buffs.
    - **Success criteria:** Clear required interior objectives (e.g., disable 2-3 internal power relays).
    - **Failure criteria:** Player death ‚Üí retry Phase 2 entry or retreat to system map.
  - **Transition 2 ‚Üí 3: Core Chamber Breach**
    - **Event:** Blast door opening + short breaching cut-in.
    - **State change:** Lock arena boundaries; enable boss logic and UI.
  - **Phase 3: Core Boss Fight (On-Foot or Hybrid)**
    - **Objective:** Destroy the Mothership core/AI with multi-step boss mechanics.
    - **Flow:** Multi-phase core fight (shielded core ‚Üí exposed core ‚Üí final overload).
    - **Signature beats:** Core shield cycles, add spawns, environmental hazards, timed damage windows.
    - **Success criteria:** Core destroyed ‚Üí campaign victory.
    - **Failure criteria:** Player death ‚Üí retry Phase 3 or retreat to system map.
  - **Difficulty/Progression Hooks**
    - Tie Phase 1 enemy density to campaign difficulty scaling.
    - Phase 2 procedural room pool grows with higher difficulty tiers.
    - Phase 3 boss modifiers unlocked by perfect-run status.
- **End Conditions:**
  - **Victory:** Destroy Mothership core ‚Üí Campaign complete overlay with stats + new campaign/menu options
  - **Perfect Run:** Complete campaign without losing any district ‚Üí Special ending
  - **Defeat:** Retreat and continue liberating districts

---

## 8. Enemy Design

### 8.1. Standard Forces

**Implementation Status: 95% Complete**

‚úÖ **Fully Implemented:**
- **Lander:** Hunts, abducts humans, mutates them if reaches top of screen
- **Mutant:** Aggressive pursuit behavior
- **Drone:** Lazy patrol with occasional shots
- **Bomber:** Horizontal patrol, drops spinning mines
- **Swarmer:** Zigzag rush behavior
- **Pod:** Sinusoidal drift, releases 3 swarmers on death
- **Baiter:** Aggressive chaser with speed bursts
- **Kamikaze:** Homes toward player, explodes on death damaging nearby enemies
- **Turret:** Plants in place, alternates cardinal/diagonal volleys
- **Shield:** Slow arc patrol with shield HP system
- **Seeker:** Predictive pursuit based on player velocity
- **Spawner:** Periodically spawns swarmers, spawns extra on death
- **Shielder:** Creates tethers to allies, heals recently damaged allies
- **Bouncer:** Erratic ricochet with direction changes
- **Sniper:** Setup phase, then stabilizes for high-speed long-range shots
- **Swarm Leader:** Buffs nearby allies with speed, debuffs enemies on death
- **Regenerator:** Self-healing with green burst aura

**Boss Implementations:**
- Mega Lander, Titan Mutant, Hive Drone, Behemoth Bomber, Colossal Pod, Leviathan Baiter, Apex Kamikaze, Fortress Turret, Overlord Shield

‚ùå **Not Implemented:**
- **Mission context differentiation:**
  - Landers: Should only appear in Defense missions
  - Mutants: Should appear more frequently in Assault missions
  - Bombers: Should be emphasized in Defense waves
- Mutants hijacking vehicles/turrets (special behavior)

### 8.2. Elite Forces

**Implementation Status: 50% Complete** ‚¨ÜÔ∏è (was 40%)

‚úÖ **Implemented:**
- Multiple boss archetypes with varied behaviors
- **Battleships:** Wave 15 mini-boss + roaming system map threats (fully functional)

‚ùå **Not Implemented:**

| Enemy Type | Behavior | Primary Context | Status |
|------------|----------|-----------------|--------|
| **Cyber-Mutants** | Blink/teleport, hybrid tech | Assault missions | Not implemented |
| **Kaiju Units** | Multi-limb bosses; destroy limbs for advantage | Special events | Not implemented |
| **Base Defenders** | Elite units protecting ground bases | Assault missions only | ‚úÖ Implemented (garrison defender squads) |

### 8.3. Base Defenses (Assault Only)

**Implementation Status: 70% Complete** ‚¨ÜÔ∏è (was 60%)

‚úÖ **Implemented:**
- **Turrets:** Auto-targeting defense systems (assault base emplacements)
- **Shield Generators:** Protect core reactor (must destroy to expose core)
- **Core Reactor:** Primary target with HP and shield gating
- **Garrison Forces:** Elite troops defending base perimeter

‚ùå **Not Implemented:**
- Multi-phase core reactor behavior beyond current base core

---

## 9. Game Systems

### 9.1. Radar / HUD

**Implementation Status: 90% Complete** ‚¨ÜÔ∏è (was 87%)

‚úÖ **Implemented:**
- Mini-radar showing player, enemies, humans, pickups
- System map with district threat indicators (friendly/threatened/occupied colors)
- Battleship position markers on the globe view
- Core HUD elements (score, wave count, timer, bombs, lives)
- Power-up status readout
- Power-up decay HUD (primary + coverage/missile/overdrive) with reduced-flash support
- **Mission Objective Indicator (Defense):** Wave count (X/15)
- **Mission Objective Indicator (Assault):** Base health bar + shield status

‚ùå **Not Implemented:**
- **Combat View:**
  - Off-screen arrows for priority targets
- **System Map:**
  - Red highlight/badge for occupied districts (color exists, not emphasized)
  - Battleship movement paths visualization
  - District timer countdown (to fall) display on globe view (timer exists in district detail panel)

### 9.2. Scoring & Rewards

**Implementation Status: 60% Complete** ‚¨ÜÔ∏è (was 55%)

‚úÖ **Implemented:**
- Enemy kills
- Human rescues
- Score display and tracking
- Wave-completion bonuses
- Mission completion credit rewards
- Currency conversion (meta credits)
- Urgency-based reward multipliers applied to meta credit earnings
- Base core destruction score bonus

‚ùå **Not Implemented:**
- **Points For:**
  - Comrade survival tracking (rescue implemented, survival not tracked)
  - Mutant reconversions (reconversion mechanic doesn't exist)
  - **Base destruction major bonus** (major meta rewards beyond current score bonus)
  - No-death run bonuses
  - Perfect district defense (no civilian casualties)
- **Currency Conversion:**
  - **District Liberation Bonus:** Major currency reward for assault victories
  - Cosmetic unlocks
  - Challenge unlocks

---

## 10. Progression & Modes

### 10.1. Core Mode: Planetary Liberation Campaign

**Implementation Status: 55% Complete** ‚¨ÜÔ∏è (was 50%)

‚úÖ **Implemented:**
- District-based mission structure
- Districts can become occupied (state exists)
- Run-to-run variation
- 15-wave defense combat mode
- Assault mission mode with base destruction
- Battleships attacking friendly districts
- Mothership node unlocks when all districts are friendly
- Start with 30-50% districts friendly, rest occupied (randomized starting states)
- Failed defenses create occupied districts that launch assault missions
- Complete defend/assault/liberate gameplay loop

‚ùå **Not Implemented:**
- **Campaign Structure:**
  - Goal: Secure all districts ‚Üí Unlock Mothership ‚Üí **Destroy Mothership** (final mission exists but is single-phase)
- **Dynamic Campaign:**
  - Player choices shape the battlefield beyond basic defense/assault outcomes
  - Strategic decisions affect difficulty curve

### 10.2. Mission Mode

**Implementation Status: 0% Complete**

‚ùå **Not Implemented - Complete System:**
- Handcrafted scenarios:
  - Hold Sector X for 5 minutes
  - **Assault Fortress Base in under 10 minutes**
  - Escort VIP transports
  - **Sabotage enemy supply lines**

### 10.3. Boss Rush

**Implementation Status: 0% Complete**

‚ùå **Not Implemented - Complete System:**
- Sequential boss fights:
  - All **battleship** encounters
  - **Special assault base commanders**
  - Final **Mothership** battle

### 10.4. Daily/Weekly Challenges

**Implementation Status: 0% Complete**

‚ùå **Not Implemented - Complete System:**
- Challenge system framework
- **Mutators:**
  - Double enemy speed
  - Only Guardian Mode allowed
  - Limited weapons
  - **"Assault Only"** - All districts start occupied
  - **"Last Stand"** - All districts threatened simultaneously

### 10.5. Additional Implemented Modes (Non-Design Scope)

‚úÖ **Implemented:**
- Survival mode (time-based objective with boss spawns at minute intervals)

---

## 11. Difficulty & Replayability

**Implementation Status: 40% Complete**

‚úÖ **Implemented:**
- Basic difficulty scaling through waves
- Meta progression unlocks
- Persistent loadout system
- District urgency scaling (timer-based)
- Urgency-based spawn multipliers (threatened/occupied districts)

‚ùå **Not Implemented:**
- **Scaling Systems:**
  - More occupied districts ‚Üí Stronger battleship forces
  - Failed defenses ‚Üí Harder assault missions (assault missions lack difficulty scaling)
  - District liberation ‚Üí Unlocks harder battleship variants
- **Unlocks:**
  - New ship skins
  - Permanent buffs for Perfect Runs
  - Harder Mothership variants
  - **Base assault equipment** (bunker busters, EMP bombs)
- **Meta Progression:**
  - Persistent upgrades carry between campaigns (structure exists, content limited)
  - Unlock starting advantages (more friendly districts at campaign start)
  - Cosmetic rewards for perfect defense records

---

## 12. Key Design Changes Summary

### Implementation Status vs. Design Goals

**New System Requirements:**

| Feature | Design Goal | Implementation Status |
|---------|-------------|---------------------|
| **Districts - Three States** | Friendly, Threatened, Occupied | ‚úÖ **Fully Implemented** |
| **Mission Types - Defense** | 15 waves with tier progression | ‚úÖ **Fully Implemented** |
| **Mission Types - Assault** | Destroy enemy ground base | ‚ö†Ô∏è **Substantially Implemented** (core + shields + turrets + garrison ‚úÖ) |
| **Battleships** | Mini-bosses that attack districts | ‚úÖ **Fully Implemented** (roaming ‚úÖ, wave 15 boss ‚úÖ) |
| **Mothership** | Final boss unlocked when all districts secured | ‚ö†Ô∏è **Partially Implemented** (unlock ‚úÖ, single-phase core fight ‚úÖ, multi-phase ‚ùå) |
| **Strategic Layer** | Balance defending vs. reclaiming | ‚ùå **Not Implemented** |
| **Dynamic Campaign** | Player failure creates challenges | ‚úÖ **Core Loop Implemented** (districts can be occupied, assault missions exist) |
| **Victory Path** | Secure planet ‚Üí Assault Mothership ‚Üí Win | ‚ö†Ô∏è **Partially Implemented** (final mission exists, multi-phase design pending) |

---

## Implementation Priority Summary

### Critical Path to MVP (Updated):

| Priority | Feature | Status | Notes |
|----------|---------|--------|-------|
| 1 | ‚úÖ District three-state system | **COMPLETE** | Friendly/Threatened/Occupied fully functional |
| 2 | ‚úÖ Assault mission core loop | **SUBSTANTIALLY COMPLETE** | Base core + shields + turrets + reinforcements |
| 3 | ‚úÖ Battleships as wave 15 boss | **COMPLETE** | Battleships spawn as wave 15 boss |
| 4 | ‚úÖ Mothership node unlock | **COMPLETE** | Unlock condition functional |
| 5 | ‚úÖ Defense mission tier progression | **COMPLETE** | Light/heavy/elite wave mix |
| 6 | ‚úÖ District state transitions | **COMPLETE** | All state changes functional |
| 7 | ‚úÖ Campaign victory condition | **COMPLETE** | Dedicated campaign victory overlay with stats + menu options |
| 8 | ‚ö†Ô∏è Strategic campaign layer | **IN PROGRESS** | Urgency + reward/spawn multipliers exist; priority UI + district values missing |
| 9 | ‚ö†Ô∏è Ground combat depth | **IN PROGRESS** | Basic on-foot combat exists; operative squads + cover missing |
| 10 | ‚ùå Additional game modes | **NOT STARTED** | Mission Mode, Boss Rush |

---

## Overall Completion Statistics

**Core Systems:**
- **Fully Complete:** 4/13 (31%)
  - Normal Fighter Form
  - Guardian Form
  - Defense Missions
  - District State System
- **Substantially Complete:** 3/13 (23%)
  - Assault Missions (core loop + garrison defenders + HUD)
  - System Map (core mechanics working, strategic layer missing)
  - Meta Progression (credits, shop/loadouts, persistence)
- **Partially Complete:** 5/13 (38%)
  - Ground Combat (pilot ejection + basic movement/shooting; no squad roles/cover)
  - Power-Up System (core drops + tiering + decay/switching; no jackpot/mystery tech)
  - Scoring & Rewards (base scoring + rescue bonus; lacks deeper incentives)
  - Campaign Mode (Mothership mission playable with HP-based phases; no exterior/interior multi-stage flow)
  - Environment Design (multi-layer parallax styles; no weather/day-night or district-specific themes)
- **Not Started:** 1/13 (8%)
  - Additional Game Modes

---

## Design Document Alignment

**Overall Implementation:**
- ‚úÖ **Implemented:** ~62% (adjusted after code audit)
- ‚ö†Ô∏è **Partially Implemented:** ~27%
- ‚ùå **Not Implemented:** ~11%

**By Category:**
- **Core Gameplay Loop:** 80% complete (Mothership fight exists, but simplified)
- **Mission Systems:** 76% complete (Defense 90%, Assault 75%, Mothership 35%)
- **Meta Systems:** 65% complete
- **Player Mechanics:** 66% complete (Ship 100%, Ground 30%, power-up decay/switching)
- **Enemy Design:** 80% complete
- **Environmental:** 35% complete ‚¨ÜÔ∏è (multi-layer parallax in place; no weather/day-night)
- **Additional Modes:** 0% complete

---

## Major Milestones Achieved

### ‚úÖ Completed Major Systems:
1. **District three-state system** - Friendly/Threatened/Occupied fully functional
2. **15-wave defense structure** - Complete with tier progression (light/heavy/elite)
3. **Assault mission core loop** - Base destruction with shields + turrets + garrison defenders
4. **Complete district state transition flow** - All win/loss outcomes implemented
5. **Battleship system** - Roaming threats + wave 15 boss fully functional
6. **Mothership unlock condition** - Activates when all districts friendly
7. **Defense/assault/liberate gameplay loop** - End-to-end campaign flow (final boss exists, multi-phase design pending)
8. **Procedural parallax environment stack** - Multi-layer sky/city/terrain backgrounds with multiple style generators
9. **Mothership assault playable** - Core arena fight with HP-based phases + reinforcements + campaign victory/defeat overlays (missing multi-stage flow)
10. **Campaign victory flow** - Dedicated campaign victory overlay with stats + new campaign/menu options
11. **Between-mission build & shop** - Loadout selection + shop unlocks integrated into district map panel
12. **Power-up decay + primary switching** - Tier decay timers with active-weapon toggle and HUD support

### üéØ Recent Achievements:
- ‚¨ÜÔ∏è Environmental stack: 40% ‚Üí 55% (multi-layer sky/atmosphere/stars + multiple styles)
- ‚¨ÜÔ∏è Assault missions: 60% ‚Üí 75% (base shields, turrets, garrison defenders, HUD)
- ‚¨ÜÔ∏è System map: 60% ‚Üí 76% (state flow + mission urgency/reward multipliers)
- ‚¨ÜÔ∏è Mothership assault: 10% ‚Üí 35% (HP-based core phases + HUD support)
- ‚¨ÜÔ∏è Campaign victory: 0% ‚Üí 100% (campaign win/defeat overlays with stats)
- ‚¨ÜÔ∏è Meta progression: 55% ‚Üí 70% (between-mission loadouts + shop unlocks)
- ‚úÖ Balance pass: projectile range-based despawn, expanded assault base turrets, and boss damage reduction + bullet patterns
---

## Immediate Next Steps (Recommended Order)

### üö® CRITICAL: Complete MVP (7-9 days)

**Priority 1: Expand Mothership Final Boss Mission (4-6 days)**
- Build Phase 1 exterior assault + phase transition setup
- Implement Phase 2 interior encounter space (on-foot focus) with objective gating
- Upgrade Phase 3 core boss to multi-step shield/HP phases (current fight is HP-based, single arena)
- Add phase-gated UI beats and cinematic transition (dock/boarding)

**Priority 2: Assault Mission Failure Flow Polish (1-2 days)**
- Add mid-mission extraction or forced retreat prompts
- Ensure assault failure messaging and retry loop feel distinct from general game-over

**Priority 3: Strategic Layer MVP Slice (2-3 days)**
- Planetary control tracker UI (friendly vs occupied)
- Explicit district priority hints (low/medium/high urgency)
- Update map panel with district value impact messaging (resource + strategic importance)

**Priority 4: Integration + Balance Pass (1-2 days)**
- Full campaign playthrough testing
- Balance pass on Mothership difficulty + assault reinforcements
- Bug fixes and polish

**Priority 5: Power-up Rewards Pass (1-2 days, stretch for MVP)**
- Add base-destruction power-up reward bursts
- Clarify power-up tier messaging in HUD (especially homing/coverage)

### üìã Post-MVP Polish (Optional)

**Phase 1: Assault Mission Depth (1 week)**
- Implement multi-phase core reactor
- Add high-value power-up drops in bases
- Polish assault difficulty scaling

**Phase 2: Power-Up Progression Depth (1 week)**
- Add homing missile tier progression (basic ‚Üí swarms ‚Üí barrage)
- Expand drone progression tiers
- Add ‚ÄúMystery Tech‚Äù/jackpot drops tied to elite/base kills

**Phase 3: Ground Combat Depth (2 weeks)**
- Operative squad system (roles: medic/engineer/turret)
- Cover mechanics + terrain interactions
- Ground weapons variety + pickup types

**Phase 4: Strategic Layer Expansion (1 week)**
- District value indicators
- Global difficulty scaling tied to occupied districts
- Battleship ‚Äúkidnap‚Äù mechanic for shop items

**Phase 5: Environment Variety (1 week)**
- District-specific background selection (tie styles to districts)
- Day/night cycle or weather modifiers

---

## Estimated Remaining Work

### MVP Completion:
- **Current Progress:** ~86% complete (adjusted after code audit)
- **Remaining Critical Work:**
  - Mothership Boss Mission (multi-phase upgrade): 4-6 days
  - Assault failure/retreat polish: 1-2 days
  - Strategic layer MVP slice: 2-3 days
  - Testing & Polish: 1-2 days
- **Total Time to Complete MVP:** 7-9 days

### Full Design Document:
- **High Priority Features:** ~38% remaining
  - Assault mission polish (multi-phase core, base rewards)
  - Strategic campaign layer + planetary control tracker
  - Enhanced rewards system + post-boss presentation polish
- **Medium Priority Features:** ~62% remaining
  - Ground combat depth (operatives, weapons, cover)
  - Power-up progression tiers (homing, drone, laser)
  - Environmental variety (weather, day/night, district themes)
- **Low Priority Features:** ~85% remaining
  - Additional game modes
  - District themes
  - Challenge systems

## MVP Completion

- **Status:** ~86% complete (core loop intact, Mothership fight present but simplified)
- **Primary Blockers:** Multi-phase Mothership mission, assault retreat/retry polish, planetary control tracker slice

---

## Critical Missing Features for Design Document Compliance

### üö® MVP Blockers:
1. **Multi-phase Mothership final boss mission** - Needs exterior ‚Üí interior ‚Üí core phases
2. **Assault mission failure/retreat loop polish** - Mid-mission extraction/retreat prompts for proper occupied-district pacing

### üìã Core Gameplay Polish:
3. **Strategic campaign layer** - Planetary control tracker, priority hints, district values, difficulty scaling
4. **Multi-phase base reactor** - Added challenge to assault missions
5. **Ground operative squad system** - Roles/cover/medic/engineer behaviors
6. **Power-up progression depth + jackpot rewards** - Tiered homing/drone progression and base/elite reward bursts

---

## What We Should Work On Next

1. **Mothership multi-phase upgrade (Exterior ‚Üí Interior ‚Üí Core)**  
   This is the single largest compliance gap and the primary MVP blocker.
2. **Assault mission retreat/redo loop polish**  
   Clarifies assault failure flow and reduces dead-end game-over friction.
3. **Strategic layer MVP slice (control tracker + priority hints + district values)**  
   Reinforces the design doc‚Äôs strategic layer and drives decision-making on the map.
4. **Multi-phase base reactor + assault reward drops**  
   Makes occupied district assaults feel meaningfully distinct and rewards risk.
5. **Power-up progression depth + jackpot rewards**  
   Adds the tiered/variable-reward loop promised in the design doc.
6. **Ground operative squad system groundwork**  
   Enables on-foot depth, roles, and rescue payoffs promised in the design doc.
