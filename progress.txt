Here is the updated `progress.txt`.

**Note on Progress Calculation:**
Because Design Document v2.0 introduces significant new mechanical systems (Squad AI, Variable Inertia, Class Systems, and the specific "Rescue-to-Deploy" loop), the overall completion percentage has **decreased** relative to the new scope. While the *codebase* hasn't changed, the *distance to the finish line* has increased.

***

# Skyline Survivors: Urban Defender - Implementation Progress (v2.0 Scope)

## 1. Core Concept

**Implementation Status: 65% Complete** â¬‡ï¸ (Adjusted for v2.0 Scope)

### Key Themes Progress:

âœ… **Fully Implemented:**
- Urban defense gameplay with district-based missions
- Ship/foot combat transitions via pilot ejection system
- Human rescue mechanics with landers and mutants
- Escalating difficulty through wave systems and boss encounters
- **Defend and Reclaim**: Districts exist in three states (Friendly/Threatened/Occupied)

âš ï¸ **Partially Implemented:**
- **Seamless transition (Ship/Foot):** Ejection exists, but the "Squad Leader" mechanics are still missing.
- **Resource vs. Score (The Rescue Loop):** Humans can be rescued for points, but they are not yet stored as "Cargo/Ammo" nor do they deploy troops upon drop-off.
- **Strategic Territory Control:** District states exist, but the "Loss Aversion" investment mechanics are missing.

âŒ **Not Implemented:**
- **Operative Depth:** The 4 distinct classes (Infantry, Gunner, Medic, Saboteur) and Defensive Perimeter AI are missing.

---

## 2. High-Level Structure

### 2.1. System View Orbital Map

**Implementation Status: 83% Complete** (Unchanged by v2.0)

âœ… **Fully Implemented:**
- 3D rotating globe with selectable districts
- **City districts** displayed as nodes with three states (Friendly, Threatened, Occupied)
- **Battleships** roam between nodes
- **Special nodes:** Weapons Satellite, Mothership (Endgame)
- Consequence system: Threatened â†’ Occupied
- **Victory Condition:** Complete Mothership assault

âŒ **Not Implemented:**
- **District Investment Levels (Dark Pattern):** Friendly districts accumulating "Prosperity Multiplier" (Loss Aversion mechanic).
- **The "Near-Miss" Timer:** 30-second flashing "CRITICAL" state.

### 2.2. Side-Scrolling Combat View

**Implementation Status: 60% Complete** â¬‡ï¸ (New Hangar/Drop-off requirement)

#### Defense Missions (Threatened Districts)
**Implementation Status: 75% Complete**
âœ… **Fully Implemented:**
- Defend districts (15 waves) / Wave tier progression
- Mini-boss and boss encounters / Battleship encounter

âŒ **Not Implemented:**
- **Extraction Hubs (Fortified Hangars):** Visual entity for dropping off humans is missing.
- **Deployment Animation:** Spawning squad members upon human drop-off.

#### Assault Missions (Occupied Districts)
**Implementation Status: 75% Complete**
âœ… **Fully Implemented:**
- Base core objective with HP / Shield generators / Turrets
- Garrison defender squads

âŒ **Not Implemented:**
- **Saboteur Synergy:** Specific interactions where Saboteurs disable turrets.
- **Guardian Form Synergy:** Increased effectiveness against structures.

---

## 3. Gameplay Overview & The Rescue Loop

### 3.1 The Rescue & Drop-Off Loop (New v2.0 Section)

**Implementation Status: 20% Complete**

âœ… **Fully Implemented:**
- Basic Human Rescue (picking up a human).

âŒ **Not Implemented:**
- **"Strike Force" Carry:** Storing multiple humans in cargo (UI indicator missing).
- **Inertia Scaling:** Ship physics do not yet change based on human cargo count.
- **Tactical Deployment:** Dropping humans at a specific Hangar point to spawn AI Comrades.

### 3.2 Core Loop

**Implementation Status: 80% Complete**
âœ… **Fully Implemented:**
- System Map -> Combat -> Upgrade cycle.
- Ship Destruction -> Ejection.

âš ï¸ **Partially Implemented:**
- **Crisis Management:** The loop of "Fight on foot -> Reach Hangar -> Rebuild Ship" now exists with a 30-second hold timer, but Squad Leader and sacrifice mechanics are still missing.

---

## 4. Player Mechanics & Operative Systems

### 4.1. Ship Forms & Movement

**Implementation Status: 90% Complete**

âœ… **Fully Implemented:**
- **Normal Fighter Form:** 8-directional movement, Primary Weapon, Smart Bomb, Hyperspace.
- **Guardian Form:** Toggle, Slowed movement, 360Â° aim.

âŒ **Not Implemented:**
- **Variable Inertia Mechanic:** Physics modifier based on `CargoCount`.
- **Guardian Defensive Perimeter:** Signaling ground AI to form a ring around the ship.

### 4.2. Operative AI & Combat Behavior ("The Comrades")

**Implementation Status: 10% Complete** (Major Gap for v2.0)

âœ… **Fully Implemented:**
- Basic concept of an "Ally" entity exists (garrison defenders).

âŒ **Not Implemented:**
- **Squad Formation:** AI following the player or forming fire teams.
- **Operative Classes:**
  - *Standard Infantry:* (Common)
  - *Heavy Gunner:* (Uncommon - Braced fire)
  - *Combat Medic:* (Rare - Health drops)
  - *Saboteur:* (Elite - Anti-base logic)
- **Weapon Synergy:** Tier 3 ship overflow upgrading ground troops.

### 4.3. On-Foot Command (Ship Destruction)

**Implementation Status: 45% Complete**

âœ… **Fully Implemented:**
- Ejection Sequence (Pilot sprite, basic pistol).
- **Extraction Defense:** Hold position under the Hangar for 30 seconds to rebuild the ship (with on-screen prompt + beacon indicator).

âŒ **Not Implemented:**
- **Squad Leader Aura:** Comrades following pilot movement (Bullet Hell wall).
- **Sacrifice Mechanic:** AI behavior to body-block shots during rebuild.

### 4.4. Power-Up System

**Implementation Status: 65% Complete**

âœ… **Fully Implemented:**
- Core Weapons (Laser, Spread, Missiles) - 3 Tiers.
- Defensive (Shields, Speed).
- Utility (Smart Bombs, Multipliers).
- Weapon Decay & Switching.

âŒ **Not Implemented:**
- **Tier 3 Overflow:** Logic to detect Max Tier and redirect power-up to Ground Troop stats.
- **Assault Rewards:** Base destruction dropping specific loot.

---

## 5. Enemy Design

**Implementation Status: 100% Complete**
âœ… **Fully Implemented:**
- Landers, Mutants, Bombers, Pods, Baiters, Swarmers.
- Advanced variants (Kamikaze, Turret, Shield, Seeker, etc.).
- Bosses (Mega Lander, Titan Mutant, etc.).

---

## 6. Game Systems

### 6.1. Radar / HUD

**Implementation Status: 80% Complete**
âœ… **Fully Implemented:**
- Radar (Player, Enemies, Objectives).
- Mission Objectives (Wave Count / Base HP).

âŒ **Not Implemented:**
- **Cargo/Squad UI:** Indicator for currently carried humans and currently deployed squad count.
- **Dark Patterns:** Engagement "Combo Meter" and pulsing "Near-Miss" urgency.

### 6.2. Meta Progression (Shop)

**Implementation Status: 75% Complete**
âœ… **Fully Implemented:**
- Supply Drop Gacha (Credits, Unboxing, Loot History).

âŒ **Not Implemented:**
- **Inventory Hot-Starts:** Applying the "Supply Drop" items to the very next run.

---

## 7. Environment Design

**Implementation Status: 55% Complete**
âœ… **Fully Implemented:**
- Multi-layer parallax (Sky, City, Street).

âŒ **Not Implemented:**
- **Extraction Hub (Hangar):** Specific visual asset for the drop-off point in Defense missions.
- Dynamic Weather/Time of Day.

---

## Gap Analysis & Next Steps (Updated for v2.0)

**Overall Implementation:**
- âœ… **Implemented:** ~65% (Dropped from 88% due to new Squad/Physics scope)
- âš ï¸ **Partially Implemented:** ~20%
- âŒ **Not Implemented:** ~15%

### ðŸš¨ Critical v2.0 Mechanics (The "New Fun")
The game is currently playable as a standard shooter, but lacks the specific "Urban Defender v2.0" hook (The Rescue Loop).

1.  **The Extraction Hub (Hangar):** Needs to be placed in the level.
2.  **The Carry Mechanic:** Ship needs `currentCargo` variable.
3.  **The Deployment Logic:** Dropping cargo at Hangar = Spawn `Operative`.
4.  **Inertia Scaling:** Ship physics update: `drag = baseDrag + (cargo * weightModifier)`.

### Revised Immediate Next Steps:

**Priority 1: The "Rescue Loop" MVP (3-4 Days)**
- Modify `ShipController` to store rescued humans as `Cargo` instead of instant score.
- Add `Hangar` entity to Defense Maps.
- Implement `DropOff` logic: If over Hangar -> Empty Cargo -> Spawn `BasicShooterBot`.
- Implement simple Inertia scaling based on Cargo count.

**Priority 2: Operative Basics (2-3 Days)**
- Create `OperativeController`.
- Behavior State Machine:
    - *State 1 (Ship Airborne):* Patrol/Engage nearest enemy.
    - *State 2 (Guardian Form):* Move to position relative to player (Defensive Ring).
    - *State 3 (On Foot):* Follow player transform (Squad Leader).

**Priority 3: Mothership & Campaign Polish (Existing Goal - 4 Days)**
- Continue with the Multi-phase Mothership boss as planned (this is still the endgame).

**Priority 4: On-Foot Rebuild (Post-MVP / Stretch)**
- âœ… Implemented a Hangar rebuild loop: reach the Hangar and hold position for 30 seconds to respawn the Veritech (with beacon + prompt).

---

## Estimated Remaining Work (v2.0 Scope)

- **Rescue/Deploy Loop:** 4 days
- **Operative AI & Classes:** 5 days
- **Mothership Boss:** 4 days
- **UI/Feedback Polish:** 2 days
- **Total to v2.0 MVP:** ~15 Days
