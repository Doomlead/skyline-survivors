# Skyline Survivors: Urban Defender

## 1. Core Concept

**Implementation Status: 70% Complete**  

### Key Themes Progress:

✅ **Fully Implemented:**
- Urban defense gameplay with district-based missions
- Ship/foot combat transitions via pilot ejection system
- Human rescue mechanics with landers and mutants
- Escalating difficulty through wave systems and boss encounters
- **Defend and Reclaim**: Districts exist in three states (Friendly/Threatened/Occupied)

⚠️ **Partially Implemented:**
- **Seamless transition (Ship/Foot):** Ejection + hangar rebuild + squad leader aura/sacrifice behaviors are online, but additional feedback polish is still needed.
- **Resource vs. Score (The Rescue Loop):** Cargo collection + deployment are in place, but tier overflow and squad synergy feedback are missing.
- **Strategic Territory Control:** District states exist, but the "Loss Aversion" investment mechanics are missing.
- **Operative Depth:** The 4 distinct classes exist with core behaviors (Infantry, Gunner, Medic, Saboteur), but Bulwark defensive perimeter logic and tier overflow are missing.

---

## 2. High-Level Structure

### 2.1. System View Orbital Map

**Implementation Status: 83% Complete**

✅ **Fully Implemented:**
- 3D rotating globe with selectable districts
- **City districts** displayed as nodes with three states (Friendly, Threatened, Occupied)
- **Battleships** roam between nodes
- **Special nodes:** Weapons Satellite, Mothership (Endgame)
- Consequence system: Threatened → Occupied
- **Victory Condition:** Complete Mothership assault

❌ **Not Implemented:**
- **District Investment Levels (Dark Pattern):** Friendly districts accumulating "Prosperity Multiplier" (Loss Aversion mechanic).
- **The "Near-Miss" Timer:** 30-second flashing "CRITICAL" state.

### 2.2. Side-Scrolling Combat View

**Implementation Status: 70% Complete** ⬆️ (Hangar/Drop-off loop now online)

#### Defense Missions (Threatened Districts)
**Implementation Status: 75% Complete**
✅ **Fully Implemented:**
- Defend districts (15 waves) / Wave tier progression
- Mini-boss and boss encounters / Battleship encounter
- Extraction hub hangar with landing zone rebuild pad
- **Deployment Animation:** Dropping off cargo spawns operative squads.

#### Assault Missions (Occupied Districts)
**Implementation Status: 75% Complete**
✅ **Fully Implemented:**
- Base core objective with HP / Shield generators / Turrets
- Garrison defender squads
- **Saboteur Synergy:** EMP-style disables against turrets/shields.

❌ **Not Implemented:**
- **Bulwark Form Synergy:** Increased effectiveness against structures.

---

## 3. Gameplay Overview & The Rescue Loop

### 3.1 The Rescue & Drop-Off Loop (New v2.0 Section)

**Implementation Status: 80% Complete**

✅ **Fully Implemented:**
- Basic Human Rescue (picking up a human).
- **"Strike Force" Carry:** Multiple humans stored in cargo with HUD indicator.
- **Inertia Scaling:** Ship physics change based on cargo count.
- **Tactical Deployment:** Dropping humans at the Hangar spawns AI Comrades.

### 3.2 Core Loop

**Implementation Status: 80% Complete**
✅ **Fully Implemented:**
- System Map -> Combat -> Upgrade cycle.
- Ship Destruction -> Ejection.
- Crisis Management: on-foot rebuild by holding the landing zone under the hangar.

---

## 4. Player Mechanics & Operative Systems

### 4.1. Ship Forms & Movement

**Implementation Status: 90% Complete**

✅ **Fully Implemented:**
- **Normal Interceptor Form:** 8-directional movement, Primary Weapon, Smart Bomb, Hyperspace.
- **Bulwark Form:** Toggle, Slowed movement, 360° aim.


### 4.2. Operative AI & Combat Behavior ("The Comrades")

**Implementation Status: 75% Complete** (Core behaviors + on-foot formation logic online)

✅ **Fully Implemented:**
- Basic concept of an "Ally" entity exists (garrison defenders).
- **Operative Classes:**
  - *Standard Infantry:* (Common)
  - *Heavy Gunner:* (Uncommon - Braced fire)
  - *Saboteur:* (Elite - Anti-base logic + EMP vs base defenses)
  - **Squad Leader Aura:** Operatives form a ring around the pilot when on foot.
  - **Sacrifice Behavior:** Operatives body-block incoming shots during hangar rebuild.

❌ **Not Implemented:**
- **Weapon Synergy:** Tier 3 ship overflow upgrading ground troops.

### 4.3. On-Foot Command (Ship Destruction)

**Implementation Status: 80% Complete**

✅ **Fully Implemented:**
- Ejection Sequence (Pilot sprite, basic pistol).
- **Extraction Defense:** Hold the landing zone under the hangar for 30s to rebuild the Aegis (with UI prompt).
- **Squad Leader Aura:** Comrades following pilot movement (Bullet Hell wall).
- **Sacrifice Mechanic:** AI behavior to body-block shots during rebuild.

### 4.4. Power-Up System

**Implementation Status: 65% Complete**

✅ **Fully Implemented:**
- Core Weapons (Laser, Spread, Missiles) - 3 Tiers.
- Defensive (Shields, Speed).
- Utility (Smart Bombs, Multipliers).
- Weapon Decay & Switching.

❌ **Not Implemented:**
- **Tier 3 Overflow:** Logic to detect Max Tier and redirect power-up to Ground Troop stats.
- **Assault Rewards:** Base destruction dropping specific loot.

---

## 5. Enemy Design

**Implementation Status: 100% Complete**
✅ **Fully Implemented:**
- Landers, Mutants, Bombers, Pods, Baiters, Swarmers.
- Advanced variants (Kamikaze, Turret, Shield, Seeker, etc.).
- Bosses (Mega Lander, Titan Mutant, etc.).

---

## 6. Game Systems

### 6.1. Radar / HUD

**Implementation Status: 80% Complete**
✅ **Fully Implemented:**
- Radar (Player, Enemies, Objectives).
- Mission Objectives (Wave Count / Base HP).

❌ **Not Implemented:**
- **Dark Patterns:** Engagement "Combo Meter" and pulsing "Near-Miss" urgency.

### 6.2. Meta Progression (Shop)

**Implementation Status: 75% Complete**
✅ **Fully Implemented:**
- Supply Drop Gacha (Credits, Unboxing, Loot History).

❌ **Not Implemented:**
- **Inventory Hot-Starts:** Applying the "Supply Drop" items to the very next run.

---

## 7. Environment Design

**Implementation Status: 55% Complete**
✅ **Fully Implemented:**
- Multi-layer parallax (Sky, City, Street).
- Extraction hub hangar with ground landing zone.

❌ **Not Implemented:**
- Dynamic Weather/Time of Day.

---

## Gap Analysis & Next Steps

### Overall Completion Statistics
- **MVP Completion:** ~70% (Core rescue/deploy loop and district flow are playable.)
- **Design Document Alignment:** ~65% (Key systems exist, but several design-only mechanics are missing.)
- **Major Milestones Achieved:** Rescue/Deploy loop, district states, assault/defense modes, hangar rebuild, operative spawning.

### Design Document Alignment
**Aligned/Implemented**
- District state system (Friendly/Threatened/Occupied).
- Rescue-to-Deploy loop (cargo carry, inertia, hangar drop-off, operative deployment).
- Assault/Defense mission flows with hangar rebuild loop.

**Partially Aligned**
- Operative depth (classes exist; missing Bulwark defensive perimeter logic).
- Power-up progression (tiering and decay exist; missing tier overflow to operatives).
- Strategic layer urgency (Threatened/Occupied exists; missing near-miss timer, prosperity loss aversion).

**Not Aligned**
- Supply Drop hot-start inventory application to next run.
- Combo/urgency feedback loops (near-miss pulses, combo meter).

### Major Milestones Achieved
- Ship/foot transition with pilot ejection and hangar rebuild.
- Cargo-based inertia and operative deployment.
- Assault base objective with garrisons/turrets/shield nodes.

### Critical Missing Features for Design Document Compliance
1. **Weapon Tier Overflow:** Redirect max-tier ship pickups to comrade scaling.
2. **Strategic Pressure Systems:** Near-miss timer flash, combo meter, prosperity/loss aversion.
3. **Supply Drop Hot-Starts:** Apply shop rewards to the next run with UI feedback.

### Immediate Next Steps (Recommended Order)
**Priority 1: Weapon Tier Overflow + Comrade Scaling (2-3 Days)**
- Detect max-tier ship pickups and redirect upgrades to ground troops (damage, fire rate, survivability).
- Add visible feedback for comrade buffs (HUD pulse or combat text).

**Priority 2: Strategic Pressure & Urgency (2 Days)**
- Add near-miss timer flash and combo meter to reinforce urgency.
- Add prosperity/loss aversion feedback on the system map (district investment levels).

**Priority 3: Supply Drop Hot-Starts (1-2 Days)**
- Apply supply drop rewards to the next run (inventory hot-starts).
- Add clear UI feedback for queued hot-start items.

**Priority 4: Mothership & Campaign Polish (4 Days)**
- Continue with the multi-phase Mothership boss as planned (endgame).

### Estimated Remaining Work
- **Operative AI & Squad Behaviors:** 2 days
- **Weapon Overflow & Buff Feedback:** 2 days
- **Strategic Pressure Systems:** 2 days
- **Supply Drop Hot-Starts:** 2 days
- **Mothership Boss:** 4 days
- **UI/Feedback Polish:** 2 days
- **Total to v2.0 MVP:** ~16 Days

### Post-MVP Polish (Optional)
- Dynamic weather/time-of-day cycles.
- Additional district visual states and destruction feedback.
- Extended audio feedback for rescue/deploy and mission transitions.

### What We Should Work on Next
Focus on the **On-Foot Squad Leader + Sacrifice Loop** first. It is the highest-impact missing system for the core “rescue-to-deploy” fantasy and will make the pilot phase feel meaningfully distinct while stabilizing the hangar rebuild loop. Once that is in place, immediately follow with weapon tier overflow so the rescue loop feeds directly into squad power and creates the intended synergy.
