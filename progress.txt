# Skyline Survivors: Urban Defender

## 1. Core Concept

**Implementation Status: 78% Complete**  

### Key Themes Progress:

✅ **Fully Implemented:**
- Urban defense gameplay with district-based missions
- Ship/foot combat transitions via pilot ejection system
- Human rescue mechanics with landers and mutants
- Escalating difficulty through wave systems and boss encounters
- **Defend and Reclaim**: Districts exist in three states (Friendly/Threatened/Occupied)
- **Squad Leader Fantasy (Core Loop):** On-foot aura, formation follow, and sacrifice/body-block behaviors
- **Active Deployment:** Humans convert into operatives when dropped at the hangar

⚠️ **Partially Implemented:**
- **Seamless transition (Ship/Foot):** Ejection + hangar rebuild + squad leader aura exist, but Bulwark/ground synergies and stronger UI messaging are missing.
- **Resource vs. Score (The Rescue Loop):** Cargo collection + deployment are in place; operative overflow scaling now routes max-tier pickups into comrade buffs with HUD/FX, but deeper squad synergy feedback loops still need polish.
- **Strategic Territory Control:** District states, timers, and prosperity investment are in; still needs tuning/balance.
- **Operative Depth:** 4 distinct classes exist with combat behaviors (Infantry, Gunner, Medic, Saboteur); Tier Overflow scaling now boosts ground troops, but stronger fire-team coordination outside of the on-foot formation is still minimal.

---

## 2. High-Level Structure

### 2.1. System View Orbital Map

**Implementation Status: 88% Complete**

✅ **Fully Implemented:**
- 3D rotating globe with selectable districts
- **City districts** displayed as nodes with three states (Friendly, Threatened, Occupied)
- **Battleships** roam between nodes
- **Special node:** Mothership (Endgame)
- Consequence system: Threatened → Occupied
- **Victory Condition:** Complete Mothership assault
- Threat timer-based urgency and pulsing visuals for threatened districts
- Critical urgency logic drives spawn/reward multipliers
- Prosperity investment loop with loss-aversion reset on occupied districts

⚠️ **Partially Implemented:**
- **The "Near-Miss" Timer:** Explicit 30s "CRITICAL" window and clutch-defense bonus are now implemented, with added map/HUD pulse FX (additional polish still possible).
- **District Investment Levels (Dark Pattern):** Prosperity multiplier exists with stronger map/HUD feedback; still needs balance tuning and cinematic polish.

### 2.2. Side-Scrolling Combat View

**Implementation Status: 78% Complete**

#### Defense Missions (Threatened Districts)
**Implementation Status: 82% Complete**
✅ **Fully Implemented:**
- Defend districts (15 waves) / Wave tier progression
- Mini-boss and boss encounters / Battleship encounter
- Extraction hub hangar with landing zone rebuild pad
- **Deployment Animation:** Dropping off cargo spawns operative squads

#### Assault Missions (Occupied Districts)
**Implementation Status: 75% Complete**
✅ **Fully Implemented:**
- Base core objective with HP / Shield generators / Turrets
- Garrison defender squads
- **Saboteur Synergy:** EMP-style disables against turrets/shields

❌ **Not Implemented:**
- **Bulwark Form Synergy:** Increased effectiveness against structures
- **Assault Rewards:** Loot drops and jackpots on base destruction

---

## 3. Gameplay Overview & The Rescue Loop

### 3.1 The Rescue & Drop-Off Loop (New v2.0 Section)

**Implementation Status: 88% Complete**

✅ **Fully Implemented:**
- Basic Human Rescue (picking up a human)
- **"Strike Force" Carry:** Multiple humans stored in cargo with HUD indicator
- **Inertia Scaling:** Ship physics change based on cargo count
- **Tactical Deployment:** Dropping humans at the Hangar spawns AI Comrades

⚠️ **Partially Implemented:**
- **Operative Scaling Feedback:** Squad size and power scaling lacks strong UI/FX feedback loops

### 3.2 Core Loop

**Implementation Status: 85% Complete**
✅ **Fully Implemented:**
- System Map -> Combat -> Upgrade cycle
- Ship Destruction -> Ejection
- Crisis Management: on-foot rebuild by holding the landing zone under the hangar

---

## 4. Player Mechanics & Operative Systems

### 4.1. Ship Forms & Movement

**Implementation Status: 90% Complete**

✅ **Fully Implemented:**
- **Normal Interceptor Form:** 8-directional movement, Primary Weapon, Smart Bomb, Hyperspace
- **Bulwark Form:** Toggle, Slowed movement, 360° aim

⚠️ **Partially Implemented:**
- **Bulwark Assault Synergy:** No structural damage or siege bonuses yet

### 4.2. Operative AI & Combat Behavior ("The Comrades")

**Implementation Status: 80% Complete**

✅ **Fully Implemented:**
- Operative spawning from hangar deployment
- **Operative Classes:** Infantry, Gunner, Medic, Saboteur
- **Formation + Aura:** On-foot squad formation, fire-rate aura, and formation offsets
- **Saboteur Assault Logic:** Assault targets prioritized with EMP disable

⚠️ **Partially Implemented:**
- **Fire-Team Coordination:** Patrol behaviors exist, but stronger group coordination and defensive perimeter logic are still minimal when the pilot is airborne.
✅ **Newly Implemented:**
- **Weapon Synergy:** Tier 3 ship overflow now upgrades ground troops with damage/fire-rate/HP buffs and HUD/FX feedback.

### 4.3. On-Foot Command (Ship Destruction)

**Implementation Status: 82% Complete**

✅ **Fully Implemented:**
- Ejection Sequence (Pilot sprite, basic pistol)
- **Extraction Defense:** Hold the landing zone under the hangar for 30s to rebuild the Aegis (with UI prompt)
- **Squad Leader Aura:** Comrades follow pilot movement in formation, boost fire rate, and re-anchor to the pilot
- **Sacrifice Mechanic:** Operatives body-block incoming projectiles during rebuild

⚠️ **Partially Implemented:**
- **Rebuild Feedback:** Needs clearer HUD emphasis for when sacrifice behavior is active

### 4.4. Power-Up System

**Implementation Status: 70% Complete**

✅ **Fully Implemented:**
- Core Weapons (Laser, Spread, Missiles) - 3 Tiers
- Defensive (Shields, Speed)
- Utility (Smart Bombs, Multipliers)
- Weapon Decay & Switching

❌ **Not Implemented:**
- **Assault Rewards:** Base destruction dropping specific loot
- **Mystery Drops:** Random effects/Jackpots

---

## 5. Enemy Design

**Implementation Status: 100% Complete**
✅ **Fully Implemented:**
- Landers, Mutants, Bombers, Pods, Baiters, Swarmers
- Advanced variants (Kamikaze, Turret, Shield, Seeker, etc.)
- Bosses (Mega Lander, Titan Mutant, etc.)
- Mothership core boss flow

---

## 6. Game Systems

### 6.1. Radar / HUD

**Implementation Status: 82% Complete**

✅ **Fully Implemented:**
- Radar (Player, Enemies, Objectives)
- Mission Objectives (Wave Count / Base HP)
- Threat/urgency display and pulsing map indicators
- Mothership HUD phase and core health

❌ **Not Implemented:**
- **Dark Patterns:** Additional loss-aversion presentation polish (cinematics, audio sting, global UI beat)

### 6.2. Meta Progression (Shop)

**Implementation Status: 88% Complete**

✅ **Fully Implemented:**
- Supply Drop Gacha (Credits, Unboxing, Loot History)
- Pending supply drop inventory display
- **Inventory Hot-Starts:** Supply drop items apply at mission start with HUD callout

---

## 7. Environment Design

**Implementation Status: 60% Complete**

✅ **Fully Implemented:**
- Multi-layer parallax (Sky, City, Street)
- Extraction hub hangar with ground landing zone
- Multiple biome background generators (industrial/cyberpunk/wasteland/mothership)

❌ **Not Implemented:**
- Dynamic Weather/Time of Day

---

## MVP Completion

- **Status:** ~79% complete (core mission loop is stable and phase-gated encounter architecture is now live across bosses, battleships, assault core, and mothership core).
- **Primary Blockers:** Full multi-space mothership finale (exterior → interior → core), Bulwark assault/siege payoff, and assault-specific loot/jackpot reward loop.

## Gap Analysis & Next Steps (Codebase Audit Refresh)

### Overall Completion Statistics
- **MVP Completion:** ~79%
- **Design Document Alignment:** ~73%
- **Major Milestones Achieved:** District state campaign loop, threatened→critical near-miss timer + clutch bonus, rescue cargo inertia + hangar deployment, operative class behaviors (including saboteur EMP), on-foot rebuild + squad aura/body-block sacrifice, supply-drop shop/hot-start pipeline, and unified shield-phase boss architecture.

### Design Document Alignment
**Aligned / Implemented**
- District strategic states (Friendly/Threatened/Occupied), with consequence flow and urgency pressure.
- 30s critical “near-miss” window and clutch-defense bonus.
- Rescue-to-deploy loop (human pickup, cargo inertia, hangar drop-off into operatives).
- Interceptor/Bulwark mode switching and on-foot rebuild sequence.
- Operative class system with saboteur assault utility and tier-overflow squad buffs.
- Supply Drop gacha + mission-start hot-start application.
- Encounter phase system (shield gate → burst window → re-prime) used by major combat objectives.

**Partially Aligned**
- Bulwark fantasy exists mechanically, but assault-specific siege advantage and clear mission payoff are still weak.
- Mothership exists as a final core encounter, but not yet a full exterior→interior→core mission chain.
- Environment/audio pillars are present, but adaptive audio layering and weather/destruction depth are still limited.

**Not Aligned (Major Remaining Gaps)**
- Assault loot rewards + mystery/jackpot drop economy.
- Challenge modes (“Last Stand”, “Assault Only” variants as formal modes/leaderboards).
- Dynamic weather and stronger world-state visual destruction feedback.

### Major Milestones Achieved
- Strategic district map with prosperity pressure and occupied-state penalties.
- Combat mission routing for defense, assault, and mothership flows.
- Hangar-centric rebuild loop with pilot ejection recovery gameplay.
- Operative class behavior suite (Infantry/Gunner/Medic/Saboteur) and sacrifice protection logic.
- Supply drop storefront, unboxing sequence, pending inventory, and hot-start integration.
- Unified phase-gated boss framework with HUD phase/gate readability.

### Critical Missing Features for Design Document Compliance
1. **Mothership Mission Expansion:** Exterior breach + interior assault + final core chain with transitions.
2. **Bulwark Assault Synergy:** Structural/siege damage bonus and explicit assault utility feedback.
3. **Assault Rewards & Mystery Drops:** Base-section loot reveal, jackpots, and better assault completion payout identity.
4. **Challenge Mode Layer:** “Last Stand” and “Assault Only” surfaced as selectable, replayable modes.

### Immediate Next Steps (Recommended Order)
1. **Expand mothership to a 3-stage mission (4-6 days)**  
   - Build Phase 1 exterior assault + phase transition setup.
   - Implement Phase 2 interior encounter space (on-foot focus) with objective gating.
   - Upgrade Phase 3 core boss to multi-step shield/HP phases (current fight is HP-based, single arena).
   - Add phase-gated UI beats and cinematic transition (dock/boarding).


2. **Ship a complete assault reward loop (2-3 days)**  
   - Add guaranteed base-core loot table, mystery-drop jackpot roll, and HUD reward callouts.

3. **Implement Bulwark siege pass (1-2 days)**  
   - Apply structural damage multipliers vs. assault objectives; add UI feedback when siege bonus is active.

4. **Formalize challenge modes (2-3 days)**  
   - Add menu entry points + basic scoring/seed handling for Last Stand and Assault Only.

### Estimated Remaining Work

### MVP Completion
- **Current Progress:** ~79%
- **Remaining Critical Work:**
  - Mothership multi-space final mission chain: 4-6 days
  - Assault rewards + mystery/jackpot loop: 2-3 days
  - Bulwark siege synergy + UI feedback: 1-2 days
  - Assault/challenge mode surfacing + polish: 2-3 days
- **Total to MVP target:** ~9-14 days

### Full Design Document
- **High Priority Remaining:** ~27%
  - Final mission structure completion
  - Assault reward economy and Bulwark assault identity
  - Challenge mode implementation
- **Medium Priority Remaining:** ~50%
  - Environment reactivity (weather/destruction feedback)
  - Advanced audio layering + cinematic event polish
  - Expanded strategic campaign presentation
- **Low Priority Remaining:** ~80%
  - Additional mode variants and leaderboard depth
  - District theme permutations and late-game content extensions

### Post-MVP Polish (Optional)
- Dynamic weather/time-of-day transitions per district.
- More pronounced destruction states for district backdrops and assault spaces.
- Adaptive music layering tied to encounter phase/urgency bands.
- Expanded audiovisual beats for deployment, clutch defense, and mission completion.
- Additional long-tail challenge mutators and leaderboard segmentation.

### What We Should Work on Next (Recommendation)
**Recommendation: do Assault Rewards + Bulwark Siege in the same sprint first.**  
Reason: these are the highest-impact gaps that immediately improve assault mission identity, reduce mode overlap with defense missions, and unblock tuning data before the larger mothership mission expansion.

**Proposed next sprint sequence:**
1. Assault reward pipeline (loot tables, mystery/jackpots, reward UX).
2. Bulwark structural bonus + on-screen confirmation cues.
3. Short tuning pass on assault pacing after rewards/siege changes land.
4. Then start mothership exterior→interior scaffolding with transition hooks already validated by phase-system HUD patterns.
