Here is the updated `progress.txt`.

**Note on Progress Calculation:**
Because Design Document v2.0 introduces significant new mechanical systems (Squad AI, Variable Inertia, Class Systems, and the specific "Rescue-to-Deploy" loop), the overall completion percentage has **decreased** relative to the new scope. While the *codebase* hasn't changed, the *distance to the finish line* has increased.

***

# Skyline Survivors: Urban Defender - Implementation Progress (v2.0 Scope)

## 1. Core Concept

**Implementation Status: 70% Complete** ‚¨ÜÔ∏è (Adjusted for v2.0 Scope)

### Key Themes Progress:

‚úÖ **Fully Implemented:**
- Urban defense gameplay with district-based missions
- Ship/foot combat transitions via pilot ejection system
- Human rescue mechanics with landers and mutants
- Escalating difficulty through wave systems and boss encounters
- **Defend and Reclaim**: Districts exist in three states (Friendly/Threatened/Occupied)

‚ö†Ô∏è **Partially Implemented:**
- **Seamless transition (Ship/Foot):** Ejection + hangar rebuild exist, but the "Squad Leader" aura/follow behavior is missing.
- **Resource vs. Score (The Rescue Loop):** Cargo collection + deployment are in place, but tier overflow and squad synergy feedback are missing.
- **Strategic Territory Control:** District states exist, but the "Loss Aversion" investment mechanics are missing.
- **Operative Depth:** The 4 distinct classes exist with core behaviors (Infantry, Gunner, Medic, Saboteur), but squad formations and Guardian defensive perimeter logic are missing.

---

## 2. High-Level Structure

### 2.1. System View Orbital Map

**Implementation Status: 83% Complete** (Unchanged by v2.0)

‚úÖ **Fully Implemented:**
- 3D rotating globe with selectable districts
- **City districts** displayed as nodes with three states (Friendly, Threatened, Occupied)
- **Battleships** roam between nodes
- **Special nodes:** Weapons Satellite, Mothership (Endgame)
- Consequence system: Threatened ‚Üí Occupied
- **Victory Condition:** Complete Mothership assault

‚ùå **Not Implemented:**
- **District Investment Levels (Dark Pattern):** Friendly districts accumulating "Prosperity Multiplier" (Loss Aversion mechanic).
- **The "Near-Miss" Timer:** 30-second flashing "CRITICAL" state.

### 2.2. Side-Scrolling Combat View

**Implementation Status: 70% Complete** ‚¨ÜÔ∏è (Hangar/Drop-off loop now online)

#### Defense Missions (Threatened Districts)
**Implementation Status: 75% Complete**
‚úÖ **Fully Implemented:**
- Defend districts (15 waves) / Wave tier progression
- Mini-boss and boss encounters / Battleship encounter
- Extraction hub hangar with landing zone rebuild pad
- **Deployment Animation:** Dropping off cargo spawns operative squads.

#### Assault Missions (Occupied Districts)
**Implementation Status: 75% Complete**
‚úÖ **Fully Implemented:**
- Base core objective with HP / Shield generators / Turrets
- Garrison defender squads
- **Saboteur Synergy:** EMP-style disables against turrets/shields.

‚ùå **Not Implemented:**
- **Guardian Form Synergy:** Increased effectiveness against structures.

---

## 3. Gameplay Overview & The Rescue Loop

### 3.1 The Rescue & Drop-Off Loop (New v2.0 Section)

**Implementation Status: 80% Complete**

‚úÖ **Fully Implemented:**
- Basic Human Rescue (picking up a human).
- **"Strike Force" Carry:** Multiple humans stored in cargo with HUD indicator.
- **Inertia Scaling:** Ship physics change based on cargo count.
- **Tactical Deployment:** Dropping humans at the Hangar spawns AI Comrades.

### 3.2 Core Loop

**Implementation Status: 80% Complete**
‚úÖ **Fully Implemented:**
- System Map -> Combat -> Upgrade cycle.
- Ship Destruction -> Ejection.
- Crisis Management: on-foot rebuild by holding the landing zone under the hangar.

---

## 4. Player Mechanics & Operative Systems

### 4.1. Ship Forms & Movement

**Implementation Status: 90% Complete**

‚úÖ **Fully Implemented:**
- **Normal Fighter Form:** 8-directional movement, Primary Weapon, Smart Bomb, Hyperspace.
- **Guardian Form:** Toggle, Slowed movement, 360¬∞ aim.

‚ùå **Not Implemented:**
- **Guardian Defensive Perimeter:** Signaling ground AI to form a ring around the ship.

### 4.2. Operative AI & Combat Behavior ("The Comrades")

**Implementation Status: 60% Complete** (Core behaviors online, formation logic missing)

‚úÖ **Fully Implemented:**
- Basic concept of an "Ally" entity exists (garrison defenders).
- **Operative Classes:**
  - *Standard Infantry:* (Common)
  - *Heavy Gunner:* (Uncommon - Braced fire)
  - *Combat Medic:* (Rare - Health drops)
  - *Saboteur:* (Elite - Anti-base logic + EMP vs base defenses)

‚ùå **Not Implemented:**
- **Squad Formation:** AI following the player or forming fire teams.
- **Weapon Synergy:** Tier 3 ship overflow upgrading ground troops.

### 4.3. On-Foot Command (Ship Destruction)

**Implementation Status: 45% Complete**

‚úÖ **Fully Implemented:**
- Ejection Sequence (Pilot sprite, basic pistol).
- **Extraction Defense:** Hold the landing zone under the hangar for 30s to rebuild the Veritech (with UI prompt).

‚ùå **Not Implemented:**
- **Squad Leader Aura:** Comrades following pilot movement (Bullet Hell wall).
- **Sacrifice Mechanic:** AI behavior to body-block shots during rebuild.

### 4.4. Power-Up System

**Implementation Status: 65% Complete**

‚úÖ **Fully Implemented:**
- Core Weapons (Laser, Spread, Missiles) - 3 Tiers.
- Defensive (Shields, Speed).
- Utility (Smart Bombs, Multipliers).
- Weapon Decay & Switching.

‚ùå **Not Implemented:**
- **Tier 3 Overflow:** Logic to detect Max Tier and redirect power-up to Ground Troop stats.
- **Assault Rewards:** Base destruction dropping specific loot.

---

## 5. Enemy Design

**Implementation Status: 100% Complete**
‚úÖ **Fully Implemented:**
- Landers, Mutants, Bombers, Pods, Baiters, Swarmers.
- Advanced variants (Kamikaze, Turret, Shield, Seeker, etc.).
- Bosses (Mega Lander, Titan Mutant, etc.).

---

## 6. Game Systems

### 6.1. Radar / HUD

**Implementation Status: 80% Complete**
‚úÖ **Fully Implemented:**
- Radar (Player, Enemies, Objectives).
- Mission Objectives (Wave Count / Base HP).

‚ùå **Not Implemented:**
- **Dark Patterns:** Engagement "Combo Meter" and pulsing "Near-Miss" urgency.

### 6.2. Meta Progression (Shop)

**Implementation Status: 75% Complete**
‚úÖ **Fully Implemented:**
- Supply Drop Gacha (Credits, Unboxing, Loot History).

‚ùå **Not Implemented:**
- **Inventory Hot-Starts:** Applying the "Supply Drop" items to the very next run.

---

## 7. Environment Design

**Implementation Status: 55% Complete**
‚úÖ **Fully Implemented:**
- Multi-layer parallax (Sky, City, Street).
- Extraction hub hangar with ground landing zone.

‚ùå **Not Implemented:**
- Dynamic Weather/Time of Day.

---

## Gap Analysis & Next Steps (Updated for v2.0)

**Overall Implementation:**
- ‚úÖ **Implemented:** ~70% (Adjusted upward as rescue/deploy loop shipped)
- ‚ö†Ô∏è **Partially Implemented:** ~20%
- ‚ùå **Not Implemented:** ~10%

### üö® Critical v2.0 Mechanics (The "New Fun")
The core Rescue Loop components (cargo carry, inertia scaling, hangar drop-off, operative deployment, HUD counters) are now present. The remaining gaps are mostly in *feel*, *feedback*, and *synergy*.

1.  **Guardian Defensive Perimeter:** Operatives forming a ring and prioritizing protection while in Guardian form.
2.  **Squad Leader Aura:** On-foot comrades follow the pilot and focus fire in formation.
3.  **Weapon Tier Overflow:** Redirect max-tier pickups to ground troop upgrades.
4.  **Sacrifice Behavior:** AI body-blocks during hangar rebuild.
5.  **Hangar-Based Rebuild Loop:** ‚úÖ Implemented (landing zone hold timer under the hangar).

### Revised Immediate Next Steps:

**Priority 1: Guardian/On-Foot Squad Behaviors (3-4 Days)**
- Implement Guardian defensive ring positioning and fire priorities.
- Add Squad Leader aura: operatives follow pilot and align their firing angles.
- Add sacrifice behavior for operatives to body-block shots during rebuild.
- Ensure transition logic between patrol/guardian/on-foot states.

**Priority 2: Weapon Tier Overflow + Comrade Scaling (2-3 Days)**
- Detect max-tier ship pickups and redirect upgrades to ground troops (damage, fire rate, or survivability).
- Add feedback for comrade buffs (HUD pulse or combat text).

**Priority 3: Dark Patterns & Urgency Feedback (2 Days)**
- Add "Near-Miss" timer flash and combo meter to reinforce urgency.
- Add Prosperity/Loss Aversion feedback on the system map.

**Priority 4: Mothership & Campaign Polish (Existing Goal - 4 Days)**
- Continue with the Multi-phase Mothership boss as planned (this is still the endgame).

---

## Estimated Remaining Work (v2.0 Scope)

- **Rescue/Deploy Loop:** 2 days
- **Operative AI & Classes:** 4 days
- **Mothership Boss:** 4 days
- **UI/Feedback Polish:** 2 days
- **Total to v2.0 MVP:** ~15 Days
