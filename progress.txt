# Skyline Survivors: Urban Defender

## 1. Core Concept

**Implementation Status: 78% Complete**  

### Key Themes Progress:

✅ **Fully Implemented:**
- Urban defense gameplay with district-based missions
- Ship/foot combat transitions via pilot ejection system
- Human rescue mechanics with landers and mutants
- Escalating difficulty through wave systems and boss encounters
- **Defend and Reclaim**: Districts exist in three states (Friendly/Threatened/Occupied)
- **Squad Leader Fantasy (Core Loop):** On-foot aura, formation follow, and sacrifice/body-block behaviors
- **Active Deployment:** Humans convert into operatives when dropped at the hangar

⚠️ **Partially Implemented:**
- **Seamless transition (Ship/Foot):** Ejection + hangar rebuild + squad leader aura exist, but Bulwark/ground synergies and stronger UI messaging are missing.
- **Resource vs. Score (The Rescue Loop):** Cargo collection + deployment are in place; operative overflow scaling now routes max-tier pickups into comrade buffs with HUD/FX, but deeper squad synergy feedback loops still need polish.
- **Strategic Territory Control:** District states, timers, and prosperity investment are in; still needs tuning/balance.
- **Operative Depth:** 4 distinct classes exist with combat behaviors (Infantry, Gunner, Medic, Saboteur); Tier Overflow scaling now boosts ground troops, but stronger fire-team coordination outside of the on-foot formation is still minimal.

---

## 2. High-Level Structure

### 2.1. System View Orbital Map

**Implementation Status: 88% Complete**

✅ **Fully Implemented:**
- 3D rotating globe with selectable districts
- **City districts** displayed as nodes with three states (Friendly, Threatened, Occupied)
- **Battleships** roam between nodes
- **Special node:** Mothership (Endgame)
- Consequence system: Threatened → Occupied
- **Victory Condition:** Complete Mothership assault
- Threat timer-based urgency and pulsing visuals for threatened districts
- Critical urgency logic drives spawn/reward multipliers
- Prosperity investment loop with loss-aversion reset on occupied districts

⚠️ **Partially Implemented:**
- **The "Near-Miss" Timer:** Explicit 30s "CRITICAL" window and clutch-defense bonus are now implemented, with added map/HUD pulse FX (additional polish still possible).
- **District Investment Levels (Dark Pattern):** Prosperity multiplier exists with stronger map/HUD feedback; still needs balance tuning and cinematic polish.

### 2.2. Side-Scrolling Combat View

**Implementation Status: 78% Complete**

#### Defense Missions (Threatened Districts)
**Implementation Status: 82% Complete**
✅ **Fully Implemented:**
- Defend districts (15 waves) / Wave tier progression
- Mini-boss and boss encounters / Battleship encounter
- Extraction hub hangar with landing zone rebuild pad
- **Deployment Animation:** Dropping off cargo spawns operative squads

#### Assault Missions (Occupied Districts)
**Implementation Status: 75% Complete**
✅ **Fully Implemented:**
- Base core objective with HP / Shield generators / Turrets
- Garrison defender squads
- **Saboteur Synergy:** EMP-style disables against turrets/shields

❌ **Not Implemented:**
- **Bulwark Form Synergy:** Increased effectiveness against structures
- **Assault Rewards:** Loot drops and jackpots on base destruction

---

## 3. Gameplay Overview & The Rescue Loop

### 3.1 The Rescue & Drop-Off Loop (New v2.0 Section)

**Implementation Status: 88% Complete**

✅ **Fully Implemented:**
- Basic Human Rescue (picking up a human)
- **"Strike Force" Carry:** Multiple humans stored in cargo with HUD indicator
- **Inertia Scaling:** Ship physics change based on cargo count
- **Tactical Deployment:** Dropping humans at the Hangar spawns AI Comrades

⚠️ **Partially Implemented:**
- **Operative Scaling Feedback:** Squad size and power scaling lacks strong UI/FX feedback loops

### 3.2 Core Loop

**Implementation Status: 85% Complete**
✅ **Fully Implemented:**
- System Map -> Combat -> Upgrade cycle
- Ship Destruction -> Ejection
- Crisis Management: on-foot rebuild by holding the landing zone under the hangar

---

## 4. Player Mechanics & Operative Systems

### 4.1. Ship Forms & Movement

**Implementation Status: 90% Complete**

✅ **Fully Implemented:**
- **Normal Interceptor Form:** 8-directional movement, Primary Weapon, Smart Bomb, Hyperspace
- **Bulwark Form:** Toggle, Slowed movement, 360° aim

⚠️ **Partially Implemented:**
- **Bulwark Assault Synergy:** No structural damage or siege bonuses yet

### 4.2. Operative AI & Combat Behavior ("The Comrades")

**Implementation Status: 80% Complete**

✅ **Fully Implemented:**
- Operative spawning from hangar deployment
- **Operative Classes:** Infantry, Gunner, Medic, Saboteur
- **Formation + Aura:** On-foot squad formation, fire-rate aura, and formation offsets
- **Saboteur Assault Logic:** Assault targets prioritized with EMP disable

⚠️ **Partially Implemented:**
- **Fire-Team Coordination:** Patrol behaviors exist, but stronger group coordination and defensive perimeter logic are still minimal when the pilot is airborne.
✅ **Newly Implemented:**
- **Weapon Synergy:** Tier 3 ship overflow now upgrades ground troops with damage/fire-rate/HP buffs and HUD/FX feedback.

### 4.3. On-Foot Command (Ship Destruction)

**Implementation Status: 82% Complete**

✅ **Fully Implemented:**
- Ejection Sequence (Pilot sprite, basic pistol)
- **Extraction Defense:** Hold the landing zone under the hangar for 30s to rebuild the Aegis (with UI prompt)
- **Squad Leader Aura:** Comrades follow pilot movement in formation, boost fire rate, and re-anchor to the pilot
- **Sacrifice Mechanic:** Operatives body-block incoming projectiles during rebuild

⚠️ **Partially Implemented:**
- **Rebuild Feedback:** Needs clearer HUD emphasis for when sacrifice behavior is active

### 4.4. Power-Up System

**Implementation Status: 70% Complete**

✅ **Fully Implemented:**
- Core Weapons (Laser, Spread, Missiles) - 3 Tiers
- Defensive (Shields, Speed)
- Utility (Smart Bombs, Multipliers)
- Weapon Decay & Switching

❌ **Not Implemented:**
- **Assault Rewards:** Base destruction dropping specific loot
- **Mystery Drops:** Random effects/Jackpots

---

## 5. Enemy Design

**Implementation Status: 100% Complete**
✅ **Fully Implemented:**
- Landers, Mutants, Bombers, Pods, Baiters, Swarmers
- Advanced variants (Kamikaze, Turret, Shield, Seeker, etc.)
- Bosses (Mega Lander, Titan Mutant, etc.)
- Mothership core boss flow

---

## 6. Game Systems

### 6.1. Radar / HUD

**Implementation Status: 82% Complete**

✅ **Fully Implemented:**
- Radar (Player, Enemies, Objectives)
- Mission Objectives (Wave Count / Base HP)
- Threat/urgency display and pulsing map indicators
- Mothership HUD phase and core health

❌ **Not Implemented:**
- **Dark Patterns:** Additional loss-aversion presentation polish (cinematics, audio sting, global UI beat)

### 6.2. Meta Progression (Shop)

**Implementation Status: 88% Complete**

✅ **Fully Implemented:**
- Supply Drop Gacha (Credits, Unboxing, Loot History)
- Pending supply drop inventory display
- **Inventory Hot-Starts:** Supply drop items apply at mission start with HUD callout

---

## 7. Environment Design

**Implementation Status: 60% Complete**

✅ **Fully Implemented:**
- Multi-layer parallax (Sky, City, Street)
- Extraction hub hangar with ground landing zone
- Multiple biome background generators (industrial/cyberpunk/wasteland/mothership)

❌ **Not Implemented:**
- Dynamic Weather/Time of Day

---

## MVP Completion

- **Status:** ~84% complete (core campaign, rescue/deploy loop, and phase-gated encounters are production-ready; major remaining work is assault reward identity + mode expansion).
- **Primary Blockers:** Assault-specific reward/jackpot loop, Bulwark siege payoff in assault spaces, and formal challenge-mode surfacing.

## Gap Analysis & Next Steps (Codebase Audit Refresh)

### Overall Completion Statistics
- **MVP Completion:** ~84%
- **Design Document Alignment:** ~80%
- **Major Milestones Achieved:** District-state campaign with threatened→critical→occupied flow, prosperity loss-aversion loop, rescue cargo inertia + hangar deployment, operative class suite (Infantry/Gunner/Medic/Saboteur), on-foot rebuild + squad sacrifice behaviors, supply-drop shop with hot-start application, unified shield-phase architecture, and a multi-step mothership finale (exterior boss -> interior breach objectives -> core chamber kill).

### Design Document Alignment
**Aligned / Implemented**
- Strategic district states with consequence pressure and prosperity reset when districts fall.
- 30-second critical near-miss window plus clutch-defense bonus multipliers.
- Rescue-to-deploy loop (human capture, cargo inertia, hangar conversion into combat operatives).
- Interceptor/Bulwark switching plus on-foot command/rebuild flow.
- Operative class behaviors including saboteur EMP utility and overflow-based squad buffs.
- Supply Drop gacha flow with pending inventory + mission-start hot-start effects.
- Unified shield-gate encounter cadence across bosses, battleships, assault core, and mothership core.
- Mothership mission now includes exterior engagement, interior objective breach, and final reactor/core chamber destruction.

**Partially Aligned**
- Bulwark fantasy is strong in control feel, but still lacks explicit siege/structure damage identity during assault missions.
- Environment/audio pillars exist (biomes, core SFX/music), but adaptive layering, weather, and destruction-reactive world feedback remain limited.
- Fire-team autonomy exists, but airborne defensive perimeter and cross-squad coordination depth is still modest.

**Not Yet Aligned (Major Remaining Gaps)**
- Assault loot rewards + mystery/jackpot drop economy on base destruction.
- Challenge modes as first-class surfaced options ("Last Stand" and "Assault Only") with scoring flow.
- Dynamic weather and deeper environmental destruction readability.

### Major Milestones Achieved
- System-map campaign loop with urgency escalation and occupied-state penalties.
- Defense/assault mission routing and directive generation from district state.
- Hangar-centric rebuild loop with pilot ejection survival gameplay.
- Operative deployment + class behavior package with sacrifice/body-block logic.
- Supply-drop economy, unboxing UX, pending inventory, and hot-start integration.
- Phase-gated encounter architecture integrated in boss, battleship, assault core, and mothership encounters.
- Multi-stage mothership finale implemented with interior transition, objective gating, and reactor kill win condition.

### Critical Missing Features for Design Document Compliance
1. **Assault Rewards & Mystery Drops:** Add guaranteed base-destruction loot tables, jackpot outcomes, and reward-callout UX.
2. **Bulwark Assault Synergy:** Add explicit structural/siege damage modifiers and feedback when Bulwark is optimally used.
3. **Challenge Mode Layer:** Surface "Last Stand" and "Assault Only" as selectable modes with score persistence.
4. **World Reactivity Layer:** Introduce weather variation and stronger destruction-state feedback across districts.

### Immediate Next Steps (Recommended Order)
1. **Ship assault reward identity (2-3 days)**  
   - Base-core completion loot table + mystery jackpot roll.
   - Post-mission summary + in-mission reward banners for assault-specific payout clarity.

2. **Implement Bulwark siege pass (1-2 days)**  
   - Structural damage multipliers against assault objectives.
   - HUD/FX indicators when Bulwark siege bonus is active.

3. **Surface challenge modes (2-3 days)**  
   - Menu entry points for Last Stand + Assault Only.
   - Lightweight score tracking flow and repeatable mode setup.

4. **Add world-reactivity slice (3-4 days)**  
   - Weather toggles per mission seed + baseline visibility variation.
   - First-pass destruction-state visuals for assaulted/occupied districts.

### Estimated Remaining Work

### MVP Completion
- **Current Progress:** ~84%
- **Remaining Critical Work:**
  - Assault rewards + jackpot loop: 2-3 days
  - Bulwark siege synergy + HUD feedback: 1-2 days
  - Challenge mode surfacing + score flow: 2-3 days
- **Total to MVP target:** ~5-8 days

### Full Design Document
- **High Priority Remaining:** ~20%
  - Assault reward economy and Bulwark assault identity
  - Challenge mode implementation and campaign-mode framing
- **Medium Priority Remaining:** ~45%
  - Weather/destruction reactivity systems
  - Expanded adaptive audio and cinematic urgency polish
  - Advanced fire-team coordination depth
- **Low Priority Remaining:** ~75%
  - Additional mode variants and leaderboard depth
  - Expanded district archetypes and long-tail content extensions

### Post-MVP Polish (Optional)
- Adaptive music layers keyed to urgency bands and boss phase transitions.
- Cinematic district-state transition stingers (critical fall, recovery, liberation).
- Richer deployment feedback (radio chatter variants, class-specific spawn VO/SFX).
- Advanced challenge mutators and leaderboard segmentation.
- Broader biome-specific hazard sets for replay variety.

### What We Should Work on Next (Recommendation)
**Recommendation: prioritize Assault Rewards first, then immediately pair with Bulwark Siege tuning in the same sprint.**  
Reason: assault missions already have objective structure and phase cadence, but currently lack a unique payoff loop. Reward identity + siege payoff will produce the biggest perceived feature gain with the smallest implementation risk, and it sets up better telemetry for balancing challenge modes afterward.

**Suggested implementation sequence for the next sprint:**
1. Implement assault base-completion loot/jackpot pipeline.
2. Add Bulwark-vs-structure bonus + clear UI confirmation.
3. Run a short balance pass on assault pacing/reward economy.
4. Promote Last Stand / Assault Only as formal menu modes once the assault loop feels distinct.
