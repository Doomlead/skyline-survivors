# Skyline Survivors: Urban Defender â€“ Design Document v2.0

## 1. Core Concept
A modern reimagining of *Defender/Stargate* fused with *Strike Force*, *Vampire Survivors*, and *Blaster Master*-style vehicle/foot combat.

**Key Themes:**
*   **Defend and Reclaim:** Districts exist in three states (Friendly, Threatened, Occupied).
*   **Active Deployment:** Humans are not just scoring items; they are the ammunition for your ground game.
*   **Seamless Transition:** Shift between piloting a heavy strike ship and fighting on foot as a Squad Leader.
*   **The "Comrade" System:** Rescued civilians become armed operatives that provide fire-and-forget support.

**The Hook:** High-intensity "sensory jackpot" combat combined with a strategic layer that leverages Loss Aversion and specific "Rescue-to-Deploy" gameplay loops.

---

## 2. High-Level Structure

### 2.1. System View Orbital Map
**Purpose:** Strategic command center showing planetary control status.
**Elements:**
*   **City Districts (Nodes):**
    *   ðŸŸ¢ **Friendly (Secured):** Accumulates "Prosperity Multiplier" (resources).
    *   ðŸŸ¡ **Threatened (Under Attack):** Requires Defense Mission. Timer based.
    *   ðŸ”´ **Occupied (Enemy Controlled):** Requires Assault Mission. Prosperity reset to zero (Loss Aversion).
*   **The "Near-Miss" Timer:** When a Threatened timer hits zero, it flashes "CRITICAL" for 30s. Starting a mission here grants a "Clutch Defense" bonus.
*   **Roaming Battleships:** Mobile boss nodes that block progress/shop items.
*   **Pilot Weapon Progression Track (District Layer):**
    *   Each district now displays a small pilot-weapon progression ribbon showing local unlock pressure for **Scattergun, Plasma Launcher, Lightning Gun, and Stinger Drone**.
    *   Clearing or defending districts grants **Pilot Intel** used to advance this ribbon; Occupied districts suppress intel gain until liberated.
    *   Every milestone reached on the ribbon grants one of the following outcomes: permanent unlock (if missing), tier increase token (if owned), or ammo-capacity bonus for the next deployment.
    *   Districts in **CRITICAL Near-Miss** state provide a temporary +50% Pilot Intel bonus, creating a tactical incentive to prioritize clutch defenses.
    *   The district tooltip shows current pilot weapon ownership and next ribbon reward so route planning naturally supports infantry progression.

**Mechanics:**
*   **Consequence System:** Ignoring Threatened â†’ District falls to Occupied â†’ Requires Assault.
*   **Victory Condition:** Secure all districts â†’ Unlock Mothership assault.

### 2.2. Side-Scrolling Combat View
**Perspective:** Horizontal wraparound map above a cityscape.
*   **Defense Missions:** Defend 1 fixed **Extraction Hub (Fortified Hangar)**. 15 Waves.
*   **Assault Missions:** Push into enemy territory to destroy a Ground Base.
*   **Key Features:** Radar HUD, Parallax Cityscape, Day/Night Cycle.

### 2.3. Meta Progression & Shop
**2.3.1. The "Supply Drop" Gacha Shop**
*   **Concept:** Variable Ratio Reinforcement. Spend credits on "Supply Drops" for single-mission advantages.
*   **Inventory Split:**
    *   **Run-Scoped Hot Starts:** Traditional one-run boosts (e.g., start with Tier 2 Laser).
    *   **Persistent Pilot Unlocks:** New pilot-weapon purchases that persist across all missions.
*   **New Pilot Upgrade Offers:**
    *   Pilot Weapon: Scattergun
    *   Pilot Weapon: Plasma Launcher
    *   Stinger Drone Capacity +2
    *   Lightning Gun: Chain Lightning Unlock

**2.3.2. The Shop "Dopamine" Sequence**
*   **Visuals:** Satellite charges energy (color indicates rarity) -> Pod slams into hangar (Screen Shake) -> God Rays reveal reward.
*   **Pilot-Upgrade Visual Feedback:** Pilot unlock purchases reveal a full **weapon model** in the God Rays instead of a flat item icon.
*   **Audio:** Shepard Tone build-up -> Bass Thud -> Casino Win Chime.

---

## 3. Gameplay Overview & The Rescue Loop

### 3.1. The Rescue & Drop-Off Loop
Instead of humans being passive scoring items, they are the primary resource for ground-game momentum.

1.  **Extraction Hubs:** Each district features 1 fixed aerial **Fortified Hangar** (Drop-off Point). These are the only locations where civilians can be converted into "Comrades."
2.  **The "Strike Force" Carry:** When the Aegis hovers over a human, they are tractor-beamed into cargo.
    *   *Mechanic:* Carrying humans increases ship weight/inertia.
    *   *Risk/Reward:* Holding multiple humans yields a higher deployment bonus but makes the Aegis harder to maneuver during high-intensity waves.
3.  **Tactical Deployment:** Dropping off humans at the Hangar triggers a **Deployment Animation**.
    *   *Result:* A squad of 3â€“5 armed operatives exits the Hangar to join the fray on the ground below.

### 3.2. Core Loop
1.  **System Map:** Choose Defense (Threatened) or Assault (Occupied).
2.  **Combat:** Pilot the Aegis -> Rescue Humans -> Deploy Comrades -> Survive Waves.
3.  **Crisis:** If the Aegis is destroyed -> Enter On-Foot Command -> Rebuild at Hangar.
4.  **Extraction:** Complete Wave 15 or Destroy Base.

---

## 4. Player Mechanics & Operative Systems

### 4.1. The Aegis: Forms & Movement
**4.1.1. Interceptor Mode (Interceptor Form)**
*   **Movement:** 8-directional. Inertia scales based on number of humans in cargo.
*   **Primary Weapon:** Forward blaster.
*   **Secondary:** Smart Bomb / Hyperspace.

**4.1.2. Bulwark Mode (Bulwark Replacement)**
*   **Activation:** Toggle button.
*   **Movement:** Drastically slowed.

### 4.2. Operative AI & Combat Behavior ("The Comrades")
These soldiers provide "fire-and-forget" support, making the battlefield feel alive.

**4.2.1. Formation Tactics**
*   Comrades move in small fire teams.
*   They automatically engage the nearest threat but will prioritize protecting the player if the player is on foot.

**4.2.2. Weapon Scaling**
*   Operatives start with basic rifles.
*   **Tier Overflow:** If the player picks up a Weapon Power-Up while the Aegis is already at **Tier 3 (Max)**, the "excess" power is distributed to ground troops, upgrading their fire rate or damage output permanently for that mission.

**4.2.3. Operative Classes**
| Operative Type | Rarity | Combat Behavior & Abilities |
| :--- | :--- | :--- |
| **Standard Infantry** | Common (65%) | Equipped with a rapid-fire rifle; auto-fires at nearest enemy. Moves in small squads to provide basic screen coverage. |
| **Heavy Gunner** | Uncommon (20%) | High DPS unit with a Gatling-style weapon. Slows down to a "braced" position to shred through Bombers or Pods. |
| **Saboteur** | Elite (5%) | Specifically targets **Enemy Ground Bases** in Assault Missions. Uses EMP grenades to disable Turrets and Shield Generators. |
| **Medic** | Rare (10%) | Prioritizes keeping nearby Comrades and the on-foot pilot alive via sustain pulses and support positioning during rebuild/extraction pressure. |

### 4.3. On-Foot Command (Ship Destruction)
If the Aegis is destroyed, the game does not end. The pilot ejects, and the genre shifts to a run-and-gun survival mode.

**4.3.0. Revised Combat Identity (Pilot Weapon Integration)**
*   On-foot combat now uses a dedicated **Pilot Weapon System** that is independent from ship weapon loadouts.
*   During both emergency On-Foot Command and interior missions, the pilot can equip and cycle infantry weapons.
*   Operatives remain active support assets, and Saboteurs gain priority interactions with interior hazards/objectives.

**4.3.1. Squad Leader Aura**
*   When on foot, nearby Comrades stop patrolling and follow the player's movement exactly.
*   **Visual:** This creates a "Bullet Hell" wall of return fire (similar to "Options" in *Gradius*), concentrating firepower wherever the pilot moves.

**4.3.2. Extraction Defense (Rebuild Mechanic)**
*   To rebuild the Aegis, the pilot must reach the **Fortified Hangar** (Drop-off point) and stand their ground.
*   **Sacrifice:** While the "Ship Rebuild" timer ticks down, Comrades will physically body-block incoming enemy fire, sacrificing themselves to ensure the pilot gets back in the air.

**4.3.3. Operative Synergy During On-Foot Command**
*   Operatives now explicitly fight alongside the pilot during emergency ground phases.
*   **Saboteur Update:** Saboteurs auto-disable nearby turrets in local combat spaces and can temporarily suppress heavy mechanical threats.

### 4.4. Pilot Weapon Upgrade System (New)
The pilot now has an independent infantry weapon progression tree. These upgrades are persistent when bought in the Supply Drop Shop and are available in all missions, including internal maps.

**4.4.1. Pilot Weapon Tree**
| Upgrade | Ammunition | Function | Tier 3 Upgrade |
| :--- | :--- | :--- | :--- |
| **Combat Rifle** | **âˆž** | **Default weapon.** Balanced semi-auto rifle with moderate damage and reliable range. | **Burst Fire:** 3-round burst mode with damage boost. |
| **Scattergun** | **200 Rounds** | Short-range shotgun with 7-pellet spread and high close-quarters damage. | **Dragon's Breath:** Incendiary rounds with burn DoT/fire trails. |
| **Plasma Launcher** | **150 Rounds** | Slow explosive plasmids with splash/AoE damage. | **Ricochet Rounds:** Projectiles bounce off walls/enemies (up to 2 bounces). |
| **Lightning Gun** | **25 Seconds Active** | Continuous stream weapon (flamethrower-style), instantly deletes weak enemies and ignores shields. | **Chain Lightning:** Arcs into up to 3 nearby targets. |
| **Stinger Drone** | **âˆž (Destructible)** | Deploys hovering auto-target drone(s) that synergize with all weapons and can be shot down. | **Combat Swarm:** Deploys 3 drones simultaneously. |

**4.4.2. Weapon Acquisition & Unlocking**
*   **Shop Purchase (Persistent):** Spend credits to permanently unlock pilot weapons for all future missions.
*   **Mission Pickup (Temporary):** Weapon crates found in interior missions grant temporary access if the weapon is not permanently owned.
*   **Pickup Stacking:** Picking up an already-owned weapon increases its tier if not already maxed.

**4.4.3. Ammo & Replenishment Rules**
*   **Infinite:** Combat Rifle and Stinger Drone (until drone destruction).
*   **Limited:** Scattergun (200), Plasma Launcher (150), Lightning Gun (25s active pool).
*   **Replenishment methods:**
    *   Rescue humans and deliver to Hangar: **+2 ammo** to current pilot weapon.
    *   Collect ammo packs from defeated enemies: restores **30% max capacity**.
    *   Mission start: owned pilot weapons begin at full ammo.

**4.4.4. Weapon Switching & HUD**
*   **Input:** Press `TAB` to cycle through unlocked pilot weapons.
*   **Switching Model:** No swap penalty/cooldown to encourage tactical swapping.
*   **HUD During On-Foot/Internal Missions:**
    *   Current weapon icon + name
    *   Ammo count / active-time meter
    *   Tier level indicator
    *   Drone counter when Stinger Drone is selected
    *   Expanded status callouts including **ELECTROCUTED** and **RADIATION**

**4.4.5. Pilot Weapon Tiers**
| Tier | Enhancement | Unlock Method |
| :--- | :--- | :--- |
| **Tier 1** | Base weapon stats | Initial unlock/pickup |
| **Tier 2** | +25% fire rate, +15% damage, enhanced VFX | Shop purchase or second pickup |
| **Tier 3 (MAX)** | +50% fire rate, +30% damage, secondary effect unlock | Shop purchase or third pickup |

**4.4.6. Interior Weapon Pickup Rules**
*   Weapon crates are visually marked with glowing letter icons: **C, S, P, L, D**.
*   Owned weapon pickup -> upgrades tier by 1 (to max tier 3).
*   Unowned weapon pickup -> mission-only temporary use.
*   **Death Penalty:** On life loss, current weapon tier drops by 1; owned weapons cannot drop below tier 1, unowned weapons revert to Combat Rifle.

### 4.5. Power-Up System
**4.5.1. Core Upgrades**
*   **Weapons:** Laser, Spread Shot, Homing Missiles (3 Tiers each).
*   **Defense:** Shields, Speed Boost.
*   **Utility:** Smart Bombs, Score Multipliers.

**4.5.2. Advanced Systems**
*   **Weapon Decay:** Power-ups have duration; encourages aggression.
*   **Mystery Drops:** Random effects/Jackpots.
*   **Assault Rewards:** Destroying base sections reveals rare power-ups.

### 4.6. Implemented Player Weapon System (Code-Accurate)
This section reflects the current in-code behavior of the player weapon stack.

**4.6.1. Fire Trigger, Rate, and Aiming Context**
*   Firing is gated by `playerState.lastFire + playerState.fireRate`; default cadence is 200ms between shots.
*   `rapid` and `overdrive` are timed modifiers that lower fire interval to 80ms and 50ms respectively while active.
*   The same fire pipeline is used for both AEGIS and pilot states, with context aim overrides:
    *   Pilot aim resolves from directional input (`getPilotAimAngle`).
    *   Bulwark mode uses an explicit aim angle (`aegisState.aimAngle`).

**4.6.2. Primary Weapon Routing (Laser vs Multi-Shot)**
*   The active primary path is `playerState.primaryWeapon` and can be switched when both trees are available.
*   If no explicit selection exists, logic defaults to Laser when available, otherwise Multi-Shot.
*   Selection auto-normalizes when tiers decay or are lost on death (prevents invalid primary states).

**4.6.3. Shot Pattern and Tier Behavior**
*   Multi-Shot tiers drive pattern geometry:
    *   Tier 0: single forward shot.
    *   Tier 1: twin parallel barrels.
    *   Tier 2: 3-way spread (`-0.15, 0, +0.15` radians).
    *   Tier 3: 5-way spread (`-0.25 ... +0.25` radians).
*   Laser tiers repurpose the same projectile pipeline but change projectile class:
    *   Tier 1: piercing beam projectile.
    *   Tier 2: wave projectile with sinusoidal lateral motion.
*   A global Piercing pickup also promotes baseline shots to piercing behavior.

**4.6.4. Coverage, Missiles, Overdrive, and Drones**
*   Coverage level 1 adds rear fire (180Â° opposite aim vector).
*   Coverage level 2 adds left/right side vectors (Â±90Â°), giving near-omnidirectional pressure.
*   Missile power-up spawns a homing projectile each trigger cycle; tier is stored per projectile (`homingTier`).
*   Overdrive adds two extra offset flame bolts each shot and concurrently enforces the fastest fire cadence.
*   Active force drones orbit the current avatar and each emit one forward drone projectile per player shot.

**4.6.5. Projectile Lifecycle and Special Logic**
*   All player projectiles store `damage`, `projectileType`, piercing flag, spawn time, and travel tracking.
*   Lifetime controls are dual-layered: hard timeout (~3s) plus range fade-out (`maxRange` based on initial speed).
*   Wave projectiles continuously alter velocity using a sine-based perpendicular offset.
*   Homing projectiles retarget nearby enemies only at missile tier 2+.
*   Tier-3 homing impacts can fork into 3 cluster homing missiles, prioritizing nearest hostile entities across enemy, garrison, boss, battleship, and assault-target groups.

**4.6.6. Damage Application Rules**
*   Base player projectile damage is 1; Double Damage temporarily raises it to 2.
*   Non-piercing shots are consumed on impact; piercing/wave shots continue through targets.
*   The same damage payload is respected by enemy, garrison, boss, battleship, and assault objective hit handlers, while boss/battleship/base shield-phase systems may gate whether damage applies to shield or HP.

**4.6.7. Power-Up Acquisition, Decay, and Overflow**
*   Weapon-tier power-ups are bounded (`laser` max 2, `multiShot` max 3, `missile` max 3, `coverage` max 2).
*   Decay timers are tracked per upgrade path (`laser`, `multiShot`, `coverage`, `missile`) with shorter durations in assault mode.
*   On decay expiration, the relevant tier drops by one and timer refreshes for the new tier until it reaches zero.
*   Overflow behavior is implemented: collecting a maxed tier in eligible paths converts into a comrade upgrade level (up to 12), improving operative durability and associated buff scaling.

### 4.7. Implemented Weapon Pickup System (Code-Accurate Deep Dive)
This section documents the exact pickup flow for weapon-related power-ups from spawn source to runtime state mutation.

**4.7.1. Where Weapon Pickups Come From**
*   **Random combat drops:**
    *   Standard enemies have a 12% drop chance on death.
    *   Garrison defenders have a 9% drop chance on death.
    *   Rescued falling/abducted humans have a 24% chance to drop a pickup.
*   **Guaranteed boss payout:** Boss deaths spawn two pickups.
*   **Support-generated pickup:** Medic support can spawn a short-lived shield pickup using the same world pickup group.
*   All of these routes converge into the same `spawnPowerUp`/`powerUps` collection path (except supply drops, which apply directly to state and do not spawn world entities).

**4.7.2. Pickup Type Pool and Spawn Representation**
*   Runtime world pickups are rolled uniformly from a 16-type pool:
    *   `laser`, `drone`, `shield`, `missile`, `overdrive`, `rear`, `side`, `rapid`, `multiShot`, `piercing`, `speed`, `magnet`, `bomb`, `double`, `invincibility`, `timeSlow`.
*   Spawned pickups are Phaser group entities with:
    *   sprite key `powerup_<type>`
    *   gameplay depth set above normal actors
    *   floating yoyo tween for readability
    *   hard despawn timer (30s default, 8s for medic shield spawns)

**4.7.3. How Collection Is Triggered**
*   Collision overlap is registered for both controllable forms:
    *   AEGIS â†” pickup
    *   Pilot â†” pickup
*   On overlap, `collectPowerUp` is the single effect dispatcher used for all pickup types.
*   On collect, the player always receives score bonus + collection SFX + floating label feedback before type-specific effects are applied.

**4.7.4. Weapon Pickup Effects (Exact State Changes)**
*   `laser`: increments `playerState.powerUps.laser` up to tier 2, refreshes laser decay timer, and can set primary weapon to laser.
*   `multiShot`: increments `playerState.powerUps.multiShot` up to tier 3, refreshes multishot decay timer, and can set primary weapon to multishot.
*   `missile`: increments missile tier up to 3 and refreshes missile decay timer.
*   `rear` / `side`: both map into shared `coverage` tier (max 2) and refresh shared coverage decay timer.
*   `piercing`: sets piercing active and ensures laser tier is at least 1 (with decay timer refresh if laser tier is raised).
*   `drone`: increments drone count up to 3 and instantiates a new orbiting drone entity immediately.
*   Related combat modifiers that affect weapon output but are timed rather than tiered:
    *   `rapid` â†’ 10s fire-rate boost
    *   `overdrive` â†’ 7s overdrive + fastest fire-rate profile
    *   `double` â†’ 8s double-damage window

**4.7.5. Decay and Tier Loss After Pickup**
*   Only four weapon paths are decay-tracked: `laser`, `multiShot`, `coverage`, `missile`.
*   Decay duration is tier-specific and comes from `POWERUP_DECAY_CONFIG`; assault mode applies a 0.75 duration multiplier.
*   When a decay timer hits zero, that path loses exactly one tier, triggers UI warning flash, and re-arms the next lower-tier timer if still above zero.
*   Primary weapon selection is auto-normalized after decay so the active weapon never points to a depleted path.

**4.7.6. Overflow Conversion (When a Pickup Is Already Maxed)**
*   Overflow is checked **before** normal pickup application.
*   Eligible overflow paths: `laser`, `multiShot`, `missile`, `rear`, `side`.
*   If incoming pickup is already at cap, the pickup is converted into a comrade upgrade instead of increasing weapon tier.
*   Overflow upgrade raises `playerState.comradeBuffs.level` (cap 12), boosts operative survivability immediately, and triggers dedicated upgrade VFX/banner messaging.

**4.7.7. Meta Supply Drop Interaction With Weapon Pickups**
*   Supply drops are a separate pre-mission system: purchased loot is stored as pending and applied directly to `playerState.powerUps`/`gameState` on mission start.
*   Because supply drops bypass world pickup entities, they do not invoke `collectPowerUp`, do not show in-world pickup labels, and do not use pickup-overlap collision.
*   Functionally, they seed starting weapon tiers/durations that then continue through the same firing, decay, and normalization logic as in-world pickups.

---

## 5. Enemy Design

### 5.1. Core Enemy Types
*   **Lander:** Descends to capture humans. If successful, ascends.
*   **Mutant:** Created from captured humans. Aggressive seeker.
*   **Bomber:** Drops mines; area denial.
*   **Pod:** Releases swarms of smaller enemies.
*   **Baiter:** Spawns if the player takes too long (anti-camping).
*   **Swarmer:** Fast, weak, overwhelms in groups.

### 5.2. Advanced Behaviors
*   **Kamikaze:** Charges and explodes on contact.
*   **Shield:** Absorbs shots; requires flanking or piercing.
*   **Sniper:** Stationary; fires high-speed shots after a delay.
*   **Healer (Regenerator):** Heals nearby biological enemies (Mutants).

### 5.3. Bosses
*   **Mega Lander:** Giant UFO with tentacles.
*   **Titan Mutant:** Massive humanoid with multiple arms.
*   **Leviathan Baiter:** Serpentine sea-monster silhouette.
*   **Fortress Turret:** Multi-barrel stationary platform.

### 5.4. Base Defenses (Assault Only)
*   **Turrets:** Auto-targeting. Saboteurs can disable these.
*   **Shield Generators:** Protect the core. Must be destroyed first.
*   **Garrison Forces:** Elite troops that only spawn within base perimeters.

---

## 6. Game Systems & UI

### 6.1. Radar / HUD
*   **Mini-Radar:** Shows Player, Comrades (Blue dots), Mutants/Enemies (Red dots), Pickups.
*   **Engagement Tracking:** A "Combo Meter" that does not reset as long as the player moves toward an objective (Flow state).
*   **Visual Urgency:** Radar pulses faster as "Near-Miss" timers approach zero.
*   **Internal Mission HUD Additions:**
    *   Active pilot weapon icon + name
    *   Ammo count or active-time meter
    *   Current weapon tier badge
    *   Drone counter when Stinger Drone is equipped
    *   Status effect banners (e.g., âš¡ ELECTROCUTED, â˜¢ï¸ RADIATION)

### 6.2. Scoring & Rewards
*   **Points:** Kills, Rescues, Base Destruction.
*   **Comrade Bonus:** Significant points for every Operative alive at mission end.
*   **Reconversion:** Rescuing a human from a Lander/Mutant grants bonus points.

---

## 7. Progression & Modes

### 7.1. Planetary Liberation Campaign
*   **Structure:** Start with ~40% friendly districts.
*   **Dynamic:** Failed defenses lead to Occupied districts (Assault missions).
*   **Endgame:** Secure 100% of districts to unlock the Mothership.

### 7.2. Mission Types
*   **Defense:** 15 Waves. Focus on keeping the Fortified Hangar safe and deploying troops.
*   **Assault:** Two-phase strike. First destroy the exterior base core, then board and destroy the interior reactor core.
*   **Mothership:** A two-part finale: exterior core siege followed by an interior boarding run-and-gun objective chain.

#### 7.2.1. Assault Base Interior Breach (Run-and-Gun Phase)
*   **Transition Trigger:** Destroying the assault base exterior defenses/core starts an interior breach sequence.
*   **Pilot-Only Lock:** The AEGIS is disabled/locked and combat continues on foot.
*   **Primary Objective:** Reach and destroy the **Reactor Core**.
*   **Map Structure:** Three authored sections with checkpoint gates.

**Section Layout**
1. **Security Hub**
   * Traps: Laser grids, locked doors (keys from fallen enemies)
   * Enemies: Base Troopers, Turret Sentries, Shock Drones
2. **Power Generation**
   * Traps: Steam vents, falling debris
   * Enemies: Heavy Mechs, Electro-Shockers, Swarm Bots
3. **Reactor Core**
   * Boss: Reactor Guardian (shielded mini-boss)
   * Hazard: Radiation zones (damage over time)

**Exclusive Assault Base Interior Enemies**
| Enemy | Behavior |
| :--- | :--- |
| **Base Trooper** | Basic rifle infantry that patrols or charges; vulnerable to Scattergun burst damage. |
| **Turret Sentry** | Stationary ceiling turret firing spread volleys; must be destroyed to open advance locks. |
| **Shock Drone** | Hover unit that drops EMP charges, disabling pilot weapons for ~3 seconds. |
| **Heavy Mech** | Slow armored walker with explosive rockets; rear engine weak spot. |
| **Electro-Shocker** | Rushes player and emits close-range electric shockwave on contact. |
| **Swarm Bot** | Small fast drones spawning in packs of 8 to pressure movement. |

*   **Saboteur Utility:** Saboteurs can temporarily disable Turret Sentries and Heavy Mechs, creating safe push windows.
*   **Win Condition:** Assault mission success requires clearing both phases: exterior destruction + interior reactor kill.

#### 7.2.2. Mothership Interior Boarding (Run-and-Gun Phase)
*   **Unlock Condition:** Available after securing 100% district control; this is the final level chain.
*   **Transition:** Destroying the exterior core triggers boarding and forces pilot-only gameplay (AEGIS locked).
*   **Primary Objective:** Traverse all decks and destroy the **Central Intelligence Core**.
*   **Map Structure:** Five escalating interior sections.

**Section Layout**
1. **Hangar Bay**
   * Traps: Landing clamps (grab/crush), emergency bulkheads
   * Enemies: Mothership Grunts, Hover Mines, Laser Turrets
2. **Bio-Labs**
   * Traps: Toxic spores (poison), containment breaches (mutant release)
   * Enemies: Mutant Test Subjects, Bio-Tanks, Security Chief
3. **Engine Room**
   * Traps: Steam jets, overloading wires
   * Enemies: Repair Bots, Plasma Fodder, Elite Engineer
4. **Shield Control**
   * Traps: Rotating shield barriers (can be disabled by Saboteur actions)
   * Enemies: Shield Operators, Assault Drones, Sniper Nest units
5. **Central Intelligence Core**
   * Boss: **The Overseer** (multi-phase)
   * Hazard: Core energy pulses (high-damage AoE every 10 seconds)

**Exclusive Mothership Interior Enemies**
| Enemy | Behavior |
| :--- | :--- |
| **Mothership Grunt** | Sonic blaster infantry that can raise a reactive shield when hurt. |
| **Hover Mine** | Floating proximity mine; can be detonated early by player fire. |
| **Mutant Test Subject** | Splits into 3 smaller mutants on death. |
| **Bio-Tank** | Stationary mutagen pod spawning fresh mutants every ~20 seconds. |
| **Repair Bot** | Repairs damaged enemy units; high-priority support target. |
| **Shield Operator** | Console-linked unit; killing it deactivates nearby shield barriers. |
| **The Overseer (Boss)** | Phase 1 missiles, Phase 2 minion summons, Phase 3 mobile charge behavior. |

*   **Saboteur Utility:** Saboteurs can hack shield-control assets/operators to open traversal lanes.
*   **Win Condition:** Destroy the Central Intelligence Core to complete campaign victory.

### 7.3. Challenges
*   **"Last Stand":** Infinite waves, global leaderboard.
*   **"Assault Only":** All districts start Occupied.

---

## 8. Environment & Audio

### 8.1. Environment
*   **Layers:** Parallax cityscape (Industrial, Residential, Military).
*   **Destruction:** Buildings take damage from enemy fire and crashed ships.
*   **Weather:** Rain/Fog affects visibility.

### 8.2. Audio Design
*   **Music:** Adaptive layers (Atmospheric -> High Energy -> Boss).
*   **SFX:** Distinct weapon sounds. "Casino-style" sounds for Shop and Deployment.
*   **Feedback:**
    *   **Rescue:** Satisfying "Lock-and-Load" sound when beaming up humans.
    *   **Deployment:** Sound of boots hitting the ground and radio chatter ("Squad deployed!") when dropping off at the Hangar.

---

## 9. Key Design Changes Summary 
*   **Resource vs. Score:** Humans are now ammunition for the ground war via the "Strike Force" Carry and Deployment system.
*   **Inertia Mechanic:** Carrying humans adds weight, creating a risk/reward balance.
*   **Operative Depth:** Added 3 distinct classes (Infantry, Gunner, Saboteur) and AI behaviors (Defensive Perimeter).
*   **Weapon Synergy:** Tier 3 ship overflow upgrades ground troops.
*   **Second Chance Mechanic:** On-Foot Command turns the pilot into a Squad Leader, using "Bullet Hell" squad tactics and "Sacrifice" mechanics to rebuild the Aegis.
---

## 10. Phase-Gated Boss Flow (v2.1 Update)

### 10.1 Unified Shield/HP Phase Architecture
All major encounters now follow a shared cadence:
1. **Shield Stage Gate** (core HP protected)
2. **Burst Damage Window** (short core vulnerability)
3. **Intermission / Shield Re-prime** (if stage chain remains)

This applies to:
- Core Bosses
- Mini-boss battleships
- Assault mission base cores
- Mothership core encounter

### 10.2 Behavior Driven by Encounter Phase (Not HP Ratio)
Boss and battleship attack timing now references the phase controller state rather than raw HP %, enabling deterministic progression beats for tuning and readability.

### 10.3 HUD/Status Alignment
Encounter HUD labels now report:
- Current phase index (e.g., Phase 2/3)
- Shield gate state (shield HP or exposed core)
- Active damage-window countdown when relevant

### 10.4 Design Intent
The new system reinforces:
- Better fight rhythm and recovery windows
- Stronger mission readability and anticipation
- Consistent final-boss language across all mission archetypes
